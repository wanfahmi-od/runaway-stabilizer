(function(a){if(typeof require==="function"&&typeof exports==="object"&&typeof module==="object"){a(require("knockout"),exports)}else{if(typeof define==="function"&&define.amd){define(["knockout","exports"],a)}else{a(ko,ko.validation={})}}}(function(i,f){if(typeof(i)==="undefined"){throw new Error("Knockout is required, please ensure it is loaded before loading this validation plug-in")}i.validation=f;var k=i.validation,j=i.utils,n=j.unwrapObservable,h=j.arrayForEach,g=j.extend;var e={registerExtenders:true,messagesOnModified:true,errorsAsTitle:true,errorsAsTitleOnModified:false,messageTemplate:null,insertMessages:true,parseInputAttributes:false,writeInputAttributes:false,decorateInputElement:false,decorateElementOnModified:true,errorClass:null,errorElementClass:"validationElement",errorMessageClass:"validationMessage",allowHtmlMessages:false,grouping:{deep:false,observable:true,live:false},validate:{}};var d=g({},e);d.html5Attributes=["required","pattern","min","max","step"];d.html5InputTypes=["email","number","date"];d.reset=function(){g(d,e)};k.configuration=d;k.utils=(function(){var s=new Date().getTime();var q={};var r="__ko_validation__";return{isArray:function(t){return t.isArray||Object.prototype.toString.call(t)==="[object Array]"},isObject:function(t){return t!==null&&typeof t==="object"},isNumber:function(t){return !isNaN(t)},isObservableArray:function(t){return !!t&&typeof t.remove==="function"&&typeof t.removeAll==="function"&&typeof t.destroy==="function"&&typeof t.destroyAll==="function"&&typeof t.indexOf==="function"&&typeof t.replace==="function"},values:function(u){var v=[];for(var t in u){if(u.hasOwnProperty(t)){v.push(u[t])}}return v},getValue:function(t){return(typeof t==="function"?t():t)},hasAttribute:function(u,t){return u.getAttribute(t)!==null},getAttribute:function(u,t){return u.getAttribute(t)},setAttribute:function(u,t,v){return u.setAttribute(t,v)},isValidatable:function(t){return !!(t&&t.rules&&t.isValid&&t.isModified)},insertAfter:function(u,t){u.parentNode.insertBefore(t,u.nextSibling)},newId:function(){return s+=1},getConfigOptions:function(t){var u=k.utils.contextFor(t);return u||k.configuration},setDomData:function(v,t){var u=v[r];if(!u){v[r]=u=k.utils.newId()}q[u]=t},getDomData:function(u){var t=u[r];if(!t){return undefined}return q[t]},contextFor:function(u){switch(u.nodeType){case 1:case 8:var t=k.utils.getDomData(u);if(t){return t}if(u.parentNode){return k.utils.contextFor(u.parentNode)}break}return undefined},isEmptyVal:function(t){if(t===undefined){return true}if(t===null){return true}if(t===""){return true}},getOriginalElementTitle:function(u){var w=k.utils.getAttribute(u,"data-orig-title"),t=u.title,v=k.utils.hasAttribute(u,"data-orig-title");return v?w:t},async:function(t){if(window.setImmediate){window.setImmediate(t)}else{window.setTimeout(t,0)}},forEach:function(u,t){if(k.utils.isArray(u)){return h(u,t)}for(var v in u){if(u.hasOwnProperty(v)){t(u[v],v)}}}}}());var c=(function(){var v=0,s=k.configuration,y=k.utils;function q(z){h(z.subscriptions,function(A){A.dispose()});z.subscriptions=[]}function t(z){if(z.options.deep){h(z.flagged,function(A){delete A.__kv_traversed});z.flagged.length=0}if(!z.options.live){q(z)}}function w(A,z){z.validatables=[];q(z);x(A,z);t(z)}function x(B,z,A){var C=[],D=B.peek?B.peek():B;if(B.__kv_traversed===true){return}if(z.options.deep){B.__kv_traversed=true;z.flagged.push(B)}A=(A!==undefined?A:z.options.deep?1:-1);if(i.isObservable(B)){if(!B.errors&&!y.isValidatable(B)){B.extend({validatable:true})}z.validatables.push(B);if(z.options.live&&y.isObservableArray(B)){z.subscriptions.push(B.subscribe(function(){z.graphMonitor.valueHasMutated()}))}}if(D&&!D._destroy){if(y.isArray(D)){C=D}else{if(y.isObject(D)){C=y.values(D)}}}if(A!==0){y.forEach(C,function(E){if(E&&!E.nodeType&&(!i.isComputed(E)||E.rules)){x(E,z,A+1)}})}}function r(z){var A=[];h(z,function(B){if(y.isValidatable(B)&&!B.isValid()){A.push(B.error.peek())}});return A}return{init:function(A,z){if(v>0&&!z){return}A=A||{};A.errorElementClass=A.errorElementClass||A.errorClass||s.errorElementClass;A.errorMessageClass=A.errorMessageClass||A.errorClass||s.errorMessageClass;g(s,A);if(s.registerExtenders){k.registerExtenders()}v=1},reset:k.configuration.reset,group:function u(A,B){B=g(g({},s.grouping),B);var z={options:B,graphMonitor:i.observable(),flagged:[],subscriptions:[],validatables:[]};var C=null;if(B.observable){C=i.computed(function(){z.graphMonitor();w(A,z);return r(z.validatables)})}else{C=function(){w(A,z);return r(z.validatables)}}C.showAllMessages=function(D){if(D===undefined){D=true}C.forEach(function(E){if(y.isValidatable(E)){E.isModified(D)}})};C.isAnyMessageShown=function(){var D;D=!!C.find(function(E){return y.isValidatable(E)&&!E.isValid()&&E.isModified()});return D};C.filter=function(D){D=D||function(){return true};C();return j.arrayFilter(z.validatables,D)};C.find=function(D){D=D||function(){return true};C();return j.arrayFirst(z.validatables,D)};C.forEach=function(D){D=D||function(){};C();h(z.validatables,D)};C.map=function(D){D=D||function(E){return E};C();return j.arrayMap(z.validatables,D)};C._updateState=function(D){if(!y.isObject(D)){throw new Error("An object is required.")}A=D;if(B.observable){z.graphMonitor.valueHasMutated()}else{w(D,z);return r(z.validatables)}};return C},formatMessage:function(z,B,A){if(y.isObject(B)&&B.typeAttr){B=B.value}if(typeof z==="function"){return z(B,A)}var C=n(B);if(C==null){C=[]}if(!y.isArray(C)){C=[C]}return z.replace(/{(\d+)}/gi,function(E,D){if(typeof C[D]!=="undefined"){return C[D]}return E})},addRule:function(A,B){A.extend({validatable:true});var z=!!j.arrayFirst(A.rules(),function(C){return C.rule&&C.rule===B.rule});if(!z){A.rules.push(B)}return A},addAnonymousRule:function(z,A){if(A.message===undefined){A.message="Error"}if(A.onlyIf){A.condition=A.onlyIf}k.addRule(z,A)},addExtender:function(z){i.extenders[z]=function(A,B){if(B&&(B.message||B.onlyIf)){return k.addRule(A,{rule:z,message:B.message,params:y.isEmptyVal(B.params)?true:B.params,condition:B.onlyIf})}else{return k.addRule(A,{rule:z,params:B})}}},registerExtenders:function(){if(s.registerExtenders){for(var z in k.rules){if(k.rules.hasOwnProperty(z)){if(!i.extenders[z]){k.addExtender(z)}}}}},insertValidationMessage:function(z){var A=document.createElement("SPAN");A.className=y.getConfigOptions(z).errorMessageClass;y.insertAfter(z,A);return A},parseInputValidationAttributes:function(A,B){h(k.configuration.html5Attributes,function(C){if(y.hasAttribute(A,C)){var D=A.getAttribute(C)||true;if(C==="min"||C==="max"){var E=A.getAttribute("type");if(typeof E==="undefined"||!E){E="text"}D={typeAttr:E,value:D}}k.addRule(B(),{rule:C,params:D})}});var z=A.getAttribute("type");h(k.configuration.html5InputTypes,function(C){if(C===z){k.addRule(B(),{rule:(C==="date")?"dateISO":C,params:true})}})},writeInputValidationAttributes:function(A,C){var B=C();if(!B||!B.rules){return}var z=B.rules();h(k.configuration.html5Attributes,function(D){var E=j.arrayFirst(z,function(F){return F.rule&&F.rule.toLowerCase()===D.toLowerCase()});if(!E){return}i.computed({read:function(){var F=i.unwrap(E.params);if(E.rule==="pattern"&&F instanceof RegExp){F=F.source}A.setAttribute(D,F)},disposeWhenNodeIsRemoved:A})});z=null},makeBindingHandlerValidatable:function(z){var A=i.bindingHandlers[z].init;i.bindingHandlers[z].init=function(D,E,B,F,C){A(D,E,B,F,C);return i.bindingHandlers.validationCore.init(D,E,B,F,C)}},setRules:function(B,z){var A=function(J,C){if(!J||!C){return}for(var F in C){if(!C.hasOwnProperty(F)){continue}var H=C[F];if(!J[F]){continue}var K=J[F],L=n(K),I={},E={};for(var G in H){if(!H.hasOwnProperty(G)){continue}if(k.rules[G]){I[G]=H[G]}else{E[G]=H[G]}}if(i.isObservable(K)){K.extend(I)}if(L&&y.isArray(L)){for(var D=0;D<L.length;D++){A(L[D],E)}}else{A(L,E)}}};A(B,z)}}}());g(i.validation,c);k.rules={};k.rules.required={validator:function(s,q){var r;if(s===undefined||s===null){return !q}r=s;if(typeof(s)==="string"){if(String.prototype.trim){r=s.trim()}else{r=s.replace(/^\s+|\s+$/g,"")}}if(!q){return true}return((r+"").length>0)},message:"This field is required."};function l(r){var q=r==="max";return function(x,u){if(k.utils.isEmptyVal(x)){return true}var s,w;if(u.typeAttr===undefined){w="text";s=u}else{w=u.typeAttr;s=u.value}if(!isNaN(s)&&!(s instanceof Date)){w="number"}var v,y,t;switch(w.toLowerCase()){case"week":v=/^(\d{4})-W(\d{2})$/;y=x.match(v);if(y===null){throw new Error("Invalid value for "+r+" attribute for week input.  Should look like '2000-W33' http://www.w3.org/TR/html-markup/input.week.html#input.week.attrs.min")}t=s.match(v);if(!t){return false}if(q){return(y[1]<t[1])||((y[1]===t[1])&&(y[2]<=t[2]))}else{return(y[1]>t[1])||((y[1]===t[1])&&(y[2]>=t[2]))}break;case"month":v=/^(\d{4})-(\d{2})$/;y=x.match(v);if(y===null){throw new Error("Invalid value for "+r+" attribute for month input.  Should look like '2000-03' http://www.w3.org/TR/html-markup/input.month.html#input.month.attrs.min")}t=s.match(v);if(!t){return false}if(q){return((y[1]<t[1])||((y[1]===t[1])&&(y[2]<=t[2])))}else{return(y[1]>t[1])||((y[1]===t[1])&&(y[2]>=t[2]))}break;case"number":case"range":if(q){return(!isNaN(x)&&parseFloat(x)<=parseFloat(s))}else{return(!isNaN(x)&&parseFloat(x)>=parseFloat(s))}break;default:if(q){return x<=s}else{return x>=s}}}}k.rules.min={validator:l("min"),message:"Please enter a value greater than or equal to {0}."};k.rules.max={validator:l("max"),message:"Please enter a value less than or equal to {0}."};k.rules.minLength={validator:function(s,q){if(k.utils.isEmptyVal(s)){return true}var r=k.utils.isNumber(s)?(""+s):s;return r.length>=q},message:"Please enter at least {0} characters."};k.rules.maxLength={validator:function(s,q){if(k.utils.isEmptyVal(s)){return true}var r=k.utils.isNumber(s)?(""+s):s;return r.length<=q},message:"Please enter no more than {0} characters."};k.rules.pattern={validator:function(r,q){return k.utils.isEmptyVal(r)||r.toString().match(q)!==null},message:"Please check this value."};k.rules.step={validator:function(s,r){if(k.utils.isEmptyVal(s)||r==="any"){return true}var q=(s*100)%(r*100);return Math.abs(q)<1e-05||Math.abs(1-q)<1e-05},message:"The value must increment by {0}."};k.rules.email={validator:function(q,r){if(!r){return true}return k.utils.isEmptyVal(q)||(r&&/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))$/i.test(q))},message:"Please enter a proper email address."};k.rules.date={validator:function(r,q){if(!q){return true}return k.utils.isEmptyVal(r)||(q&&!/Invalid|NaN/.test(new Date(r)))},message:"Please enter a proper date."};k.rules.dateISO={validator:function(r,q){if(!q){return true}return k.utils.isEmptyVal(r)||(q&&/^\d{4}[-/](?:0?[1-9]|1[012])[-/](?:0?[1-9]|[12][0-9]|3[01])$/.test(r))},message:"Please enter a proper date."};k.rules.number={validator:function(r,q){if(!q){return true}return k.utils.isEmptyVal(r)||(q&&/^-?(?:\d+|\d{1,3}(?:,\d{3})+)?(?:\.\d+)?$/.test(r))},message:"Please enter a number."};k.rules.digit={validator:function(r,q){if(!q){return true}return k.utils.isEmptyVal(r)||(q&&/^\d+$/.test(r))},message:"Please enter a digit."};k.rules.phoneUS={validator:function(q,r){if(!r){return true}if(k.utils.isEmptyVal(q)){return true}if(typeof(q)!=="string"){return false}q=q.replace(/\s+/g,"");return r&&q.length>9&&q.match(/^(1-?)?(\([2-9]\d{2}\)|[2-9]\d{2})-?[2-9]\d{2}-?\d{4}$/)},message:"Please specify a valid phone number."};k.rules.equal={validator:function(s,r){var q=r;return s===k.utils.getValue(q)},message:"Values must equal."};k.rules.notEqual={validator:function(s,r){var q=r;return s!==k.utils.getValue(q)},message:"Please choose another value."};k.rules.unique={validator:function(u,t){var q=k.utils.getValue(t.collection),s=k.utils.getValue(t.externalValue),r=0;if(!u||!q){return true}j.arrayFilter(q,function(v){if(u===(t.valueAccessor?t.valueAccessor(v):v)){r++}});return r<(!!s?1:2)},message:"Please make sure the value is unique."};(function(){k.registerExtenders()}());i.bindingHandlers.validationCore=(function(){return{init:function(t,w,q,x,r){var s=k.utils.getConfigOptions(t);var u=w();if(s.parseInputAttributes){k.utils.async(function(){k.parseInputValidationAttributes(t,w)})}if(s.insertMessages&&k.utils.isValidatable(u)){var v=k.insertValidationMessage(t);if(s.messageTemplate){i.renderTemplate(s.messageTemplate,{field:u},null,v,"replaceNode")}else{i.applyBindingsToNode(v,{validationMessage:u})}}if(s.writeInputAttributes&&k.utils.isValidatable(u)){k.writeInputValidationAttributes(t,w)}if(s.decorateInputElement&&k.utils.isValidatable(u)){i.applyBindingsToNode(t,{validationElement:u})}}}}());k.makeBindingHandlerValidatable("value");k.makeBindingHandlerValidatable("checked");if(i.bindingHandlers.textInput){k.makeBindingHandlerValidatable("textInput")}k.makeBindingHandlerValidatable("selectedOptions");i.bindingHandlers.validationMessage={update:function(r,A){var y=A(),q=k.utils.getConfigOptions(r),z=n(y),x=null,u=false,v=false;if(y===null||typeof y==="undefined"){throw new Error("Cannot bind validationMessage to undefined value. data-bind expression: "+r.getAttribute("data-bind"))}u=y.isModified&&y.isModified();v=y.isValid&&y.isValid();var s=null;if(!q.messagesOnModified||u){s=v?null:y.error}var w=!q.messagesOnModified||u?!v:false;var t=r.style.display!=="none";if(q.allowHtmlMessages){j.setHtml(r,s)}else{i.bindingHandlers.text.update(r,function(){return s})}if(t&&!w){r.style.display="none"}else{if(!t&&w){r.style.display=""}}}};i.bindingHandlers.validationElement={update:function(t,z,q){var x=z(),r=k.utils.getConfigOptions(t),y=n(x),w=null,u=false,v=false;if(x===null||typeof x==="undefined"){throw new Error("Cannot bind validationElement to undefined value. data-bind expression: "+t.getAttribute("data-bind"))}u=x.isModified&&x.isModified();v=x.isValid&&x.isValid();var s=function(){var A={};var B=((!r.decorateElementOnModified||u)?!v:false);A[r.errorElementClass]=B;return A};i.bindingHandlers.css.update(t,s,q);if(!r.errorsAsTitle){return}i.bindingHandlers.attr.update(t,function(){var A=!r.errorsAsTitleOnModified||u,B=k.utils.getOriginalElementTitle(t);if(A&&!v){return{title:x.error,"data-orig-title":B}}else{if(!A||v){return{title:B,"data-orig-title":null}}}})}};i.bindingHandlers.validationOptions=(function(){return{init:function(s,v,q,w,r){var u=n(v());if(u){var t=g({},k.configuration);g(t,u);k.utils.setDomData(s,t)}}}}());i.extenders.validation=function(q,r){h(k.utils.isArray(r)?r:[r],function(s){k.addAnonymousRule(q,s)});return q};i.extenders.validatable=function(t,u){if(!k.utils.isObject(u)){u={enable:u}}if(!("enable" in u)){u.enable=true}if(u.enable&&!k.utils.isValidatable(t)){var q=k.configuration.validate||{};var v={throttleEvaluation:u.throttle||q.throttle};t.error=i.observable(null);t.rules=i.observableArray();t.isValidating=i.observable(false);t.__valid__=i.observable(true);t.isModified=i.observable(false);t.isValid=i.computed(t.__valid__);t.setError=function(w){var x=t.error.peek();var y=t.__valid__.peek();t.error(w);t.__valid__(false);if(x!==w&&!y){t.isValid.notifySubscribers()}};t.clearError=function(){t.error(null);t.__valid__(true);return t};var r=t.subscribe(function(){t.isModified(true)});var s=i.computed(g({read:function(){var w=t(),x=t.rules();k.validateObservable(t);return true}},v));g(s,v);t._disposeValidation=function(){t.isValid.dispose();t.rules.removeAll();r.dispose();s.dispose();delete t.rules;delete t.error;delete t.isValid;delete t.isValidating;delete t.__valid__;delete t.isModified;delete t.setError;delete t.clearError;delete t._disposeValidation}}else{if(u.enable===false&&t._disposeValidation){t._disposeValidation()}}return t};function p(r,s,q){if(!s.validator(r(),(q.params===undefined?true:n(q.params)))){r.setError(k.formatMessage(q.message||s.message,n(q.params),r));return false}else{return true}}function o(s,t,r){s.isValidating(true);var q=function(w){var u=false,v="";if(!s.__valid__()){s.isValidating(false);return}if(w.message){u=w.isValid;v=w.message}else{u=w}if(!u){s.error(k.formatMessage(v||r.message||t.message,n(r.params),s));s.__valid__(u)}s.isValidating(false)};k.utils.async(function(){t.validator(s(),r.params===undefined?true:n(r.params),q)})}k.validateObservable=function(t){var r=0,u,q,v=t.rules(),s=v.length;for(;r<s;r++){q=v[r];if(q.condition&&!q.condition()){continue}u=q.rule?k.rules[q.rule]:q;if(u.async||q.async){o(t,u,q)}else{if(!p(t,u,q)){return false}}}t.clearError();return true};var b={};var a;k.defineLocale=function(q,r){if(q&&r){b[q.toLowerCase()]=r;return r}return null};k.locale=function(q){if(q){q=q.toLowerCase();if(b.hasOwnProperty(q)){k.localize(b[q]);a=q}else{throw new Error("Localization "+q+" has not been loaded.")}}return a};k.localize=function(q){var s=k.rules;for(var r in q){if(s.hasOwnProperty(r)){s[r].message=q[r]}}};(function(){var q={};var s=k.rules;for(var r in s){if(s.hasOwnProperty(r)){q[r]=s[r].message}}k.defineLocale("en-us",q)})();a="en-us";i.applyBindingsWithValidation=function(u,t,s){var r=document.body,q;if(t&&t.nodeType){r=t;q=s}else{q=t}k.init();if(q){q=g(g({},k.configuration),q);k.utils.setDomData(r,q)}i.applyBindings(u,r)};var m=i.applyBindings;i.applyBindings=function(r,q){k.init();m(r,q)};i.validatedObservable=function(q,s){if(!s&&!k.utils.isObject(q)){return i.observable(q).extend({validatable:true})}var r=i.observable(q);r.errors=k.group(k.utils.isObject(q)?q:{},s);r.isValid=i.observable(r.errors().length===0);if(i.isObservable(r.errors)){r.errors.subscribe(function(t){r.isValid(t.length===0)})}else{i.computed(r.errors).subscribe(function(t){r.isValid(t.length===0)})}r.subscribe(function(t){if(!k.utils.isObject(t)){t={}}r.errors._updateState(t);r.isValid(r.errors().length===0)});return r}}));