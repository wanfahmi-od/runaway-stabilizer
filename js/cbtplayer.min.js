/*
 * CBT Player v1.7.5.22153(Local)
 * 2019 Copyright - Pelesys Learning Systems Inc. - All Rights Reserved 
 */
var Menu=function(a){var c=this;var b={onClose:function(){},onOpen:function(){}};b=$.extend(true,b,a);if(!b.id){throw new Error("id is missing.")}if(!b.type){throw new Error("type is missing.")}if(!b.wrapper){throw new Error("wrapper is missing.")}if(!b.maskId){throw new Error("maskId is missing.")}this._initEvents=function(){this.$mask.on("click",function(d){d.preventDefault();d.stopPropagation();this.close()}.bind(this))};this.open=function(){this.$body.addClass("has-active-menu");this.$wrapper.addClass("has-"+b.type);this.$menu.addClass("is-active");this.$mask.addClass("is-active");setTimeout(function(){b.onOpen()},500)};this.close=function(){this.$body.removeClass("has-active-menu");this.$wrapper.removeClass("has-"+b.type);this.$menu.removeClass("is-active");this.$mask.removeClass("is-active");setTimeout(function(){b.onClose()},500)};this._init=function(){this.$body=$("body");this.$wrapper=$(b.wrapper);this.$mask=$(b.maskId);this.$menu=$("#"+b.id);this._initEvents()};this._init()};function CBTPlayer(a){var c=this;this._className="CBTPlayer";var b={developerMode:false,launchOptionsMode:false,dataSourcePath:null,dataSourceType:"xml",dataVariable:null,startPageId:null,idleTimeOutMinutes:5,buttons:{language:true,glossary:true,reference:true,comments:true,audio:true,audioText:true,sections:false,progress:true},fastAdvance:false,uiLangCodes:["en"],defaultOrganizationId:null,organizations:[],lmsType:"local",completionType:"pagescomplete-noscore",hiddenItems:[],pageLoadingTimeoutDuration:30,topicCompletionMessages:true,lmsContentProtection:true,controlBarTopColor:"#162333",controlBarBottomColor:"#162333",titleBarColor:"#005EB8",contentContainerBackgroundColor:"#999999",controlBarBottomIconColor:"#FFFFFF",controlBarBottomActiveIconColor:"#005eb8",topicColor:"#2482dc",_playSpeed:1,_autoPlay:false,_autoPlaySkipTimeout:90,_enableLocalStorage:false,_canvasGraphicsQuality:"auto",ui:"pele2019",_singleFrame:true};b=ds.utils.Merge(b,a);this._originalOpts=b;this.config=new PlayerConfigModel(b);this.InitPlayerConfig=function(){var e=c.lmsAPIController.configData;if(e){c.config.MergeModel(e)}else{var d=window.opener&&window.opener.developerAPI&&window.opener.developerAPI.getPlayerConfig();if(d){c.config.MergeModel(d)}}};this.GetVersion=function(){return"1.7.5.22153"};this.ui=ko.observable();this._ui=ko.pureComputed(function(){return c.config.ui()==="pele2017"?"images/plogowhite.png":"images/pclogowhite.png"},this);this.InitUI=function(){var e=new $.Deferred();function d(){var h=CBTPlayer._userInterfaces[c.config.ui()];h.call(c,{});c.ui(c.config.ui());e.resolve()}if(c.ui()&&c.ui()===c.config.ui()){e.resolve()}else{if(!CBTPlayer._userInterfaces[c.config.ui()]){var g="ui/"+c.config.ui()+"/"+c.config.ui()+".js";var f="_"+c.config.ui();$.when(ds.utils.LoadObjectFromScriptFile(g,f)).done(function(){d()})}else{d()}}return e.promise()};this.CloseAllModals=function(){$(".modal.in").modal("hide");c.CloseMenu();c.CloseOptionsMenu()};this.GetContentHeight=function(){return 0};this.langs=ko.observableArray();this.lang=ko.observable({title:null,code:null,dict:{}});this.InitUiLang=function(){var h=new $.Deferred();c.langs([]);window.Langs=window.Langs||{};var g=c.config.uiLangCodes();var d=c.config.uiLangCodes()[0];var e=[];function f(i){var j=new $.Deferred();if(Langs[i]){c.langs.push(Langs[i]);j.resolve()}else{var l="js/lang/cbtplayer-"+i+".js";var k="_lang_"+i;$.when(ds.utils.LoadObjectFromScriptFile(l,k)).done(function(){c.langs.push(Langs[i]);j.resolve()})}return j.promise()}ko.utils.arrayForEach(g,function(i){e.push(f(i))});$.when.apply($,e).then(function(){var i=arguments;if(Langs[d]){c.lang(Langs[d])}else{c.lang(Langs.en)}h.resolve()});return h.promise()};this.SelectUILanguage=function(d){c.lang(d);c.ChangeGlossaryTableTitleLang(d)};this.ChangeGlossaryTableTitleLang=function(){if(c.glossaryTable){$(c.glossaryTable.column(0).header()).text(c.lang().dict.name);$(c.glossaryTable.column(1).header()).text(c.lang().dict.definition)}};this.IsUILanguageSelected=function(d){return c.lang().code===d.code};this.ShowLanguage=function(){$("#language-modal").modal("show")};this.cbt=new CBTStructureModel();this.InitDataSource=function(i){var e=null;if(!i){throw new Error("type is missing.")}var d=c.config.dataSourcePath();var h=d.split("/").pop();var g=h.split(".").pop();if((c.config.dataSourceType()==="xml"&&i!==g)||(c.config.dataSourceType()==="sco2004"&&h!=="imsmanifest.xml")){this.ShowErrorMessage("Data error: Data Source type '"+i+"' is not same as the course "+c.config.dataSourcePath());return false}e=CBTPlayer._dataSources[i];if(!e){this.ShowErrorMessage("Data error: Data Source type '"+i+"' is not recognized.")}else{var f=new e({player:c,model:c.cbt,src:c.config.dataSourcePath(),hiddenItems:ko.toJS(c.config.hiddenItems)});return f}};this.GetCBTData=function(){return ko.toJS(c.cbt)};this.currentOrg=ko.observable(new CBTOrganizationModel());this.organizations=ko.observableArray();this.InitOrganizations=function(){this.organizations([]);if(this.config.organizations().length>0){ko.utils.arrayForEach(c.config.organizations(),function(f){if(c.cbt.organizationsDict()[f]){c.organizations.push(c.cbt.organizationsDict()[f])}})}else{ko.utils.arrayForEach(c.cbt.organizations(),function(f){c.organizations.push(f)})}if(this.config.defaultOrganizationId()){this.cbt.defaultOrganizationId(c.config.defaultOrganizationId())}var e=[];if(this.organizations().length){e=this.organizations()}else{e=this.cbt.organizations()}var d=ko.utils.arrayFirst(e,function(f){return f.id===c.cbt.defaultOrganizationId()});if(d){c.currentOrg(d)}else{c.currentOrg(e[0])}};this.GetCurrentOrganization=function(){return ko.toJS(c.currentOrg())};this.IsOrganizationSelected=function(d){if(d){return c.currentOrg().id===d.id}else{return false}};this.SelectOrganization=function(d){if(d.id===c.currentOrg().id){return}c.SyncOrganizationStatus(d);c.currentOrg(d);$("#language-modal").modal("hide");c.currentPage()&&c.LoadPageById(c.currentPage().id)};this.SyncOrganizationStatus=function(d){if(d){ko.utils.arrayForEach(c.currentOrg().pagesList(),function(e){var f=d.itemsDict()[e.id];if(f){f.visited(e.visited());f.completed(e.completed());f.playbackFinished(e.playbackFinished())}})}};this._doShowLMSWarning=false;this.lmsAPIController=new Local({player:this,cbt:this.cbt,org:this.currentOrg});this.InitLMSAPI=function(){var i=new $.Deferred();var e=null;var h=this.config.lmsType();var d=h.split(",");var f=0;function g(j){$.when(c._ProcessLMSType(d[j])).done(function(){i.resolve()}).fail(function(){if(j===d.length-1){c._doShowLMSWarning=true;c._readyToExit=true;c.lmsAPIController=new Local({player:c,cbt:c.cbt,org:c.currentOrg});i.resolve()}else{g(++j)}})}g(f);return i.promise()};this._ProcessLMSType=function(f){var e=new $.Deferred();f=f?f.trim():"";controllerClass=CBTPlayer._lmsApiControllers[f];if(!controllerClass){this.ShowErrorMessage("Data error: LMS type '"+f+"' is not recognized.");e.reject()}var d={player:this,cbt:this.cbt,org:this.currentOrg};this.lmsAPIController=new controllerClass(d);$.when(this.lmsAPIController.Init()).done(function(g,h,i){c.cbt.sessionStartTime(new Date());c.config.lmsType.valueHasMutated();if(f.toLowerCase().match(/local/)!==null&&c.config.lmsContentProtection()){e.reject()}e.resolve()}).fail(function(){e.reject()});return e.promise()};this.completion=new CompletionBase({org:this.currentOrg});this.InitCompletion=function(){var d=null;var f=this.config.completionType();d=CBTPlayer._completionControllers[f];if(!d){this.ShowErrorMessage("Data error: Course completion type '"+f+"' is not recognized.")}else{var e={org:this.currentOrg};this.completion=new d(e);this.completion.Init(this)}this.cbt._completion=this.completion;this.currentOrg()._completion=this.completion};this.SaveCBTData=function(){if(c._initialized){c.lmsAPIController.SaveCBTData()}};this.CyclePageStatus=function(d){if(d.type==="topic"||d.type==="mergedpages"){this.CycleTopicStatus(d);return}if(d){if(d.visited()){if(d.completed()){d.visited(false);d.completed(false)}else{d.visited(true);d.completed(true)}}else{if(d.completed()){}else{d.visited(true);d.completed(false)}}}else{return false}};this.CycleTopicStatus=function(e){var d=e.completed();var h=e.visited();function g(i){ko.utils.arrayForEach(i.items(),function(j){if(j.type==="topic"||j.type==="mergedpages"){g(j)}else{f(j)}})}function f(i){if(d){i.visited(false);i.completed(false)}else{if(h){i.visited(true);i.completed(true)}else{i.visited(true);i.completed(false)}}}if(e&&e.type==="topic"||e.type==="mergedpages"){g(e)}else{return false}};this._DevCycleStatus=function(e,d){if(!c.config.developerMode()){return}if(e.type==="topic"||e.type==="mergedpages"){c.CycleTopicStatus(e)}else{c.CyclePageStatus(e)}c.currentOrg().items.valueHasMutated();d&&d.stopPropagation()};this.ShowCourseCompletedMessage=function(){var d=c.lang().dict.courseCompleted;bootbox.dialog({message:d,buttons:{exit:{label:c.lang().dict.exit,className:"btn-danger",callback:function(){c.Exit()}},home:{label:c.lang().dict.home,className:"btn-primary",callback:function(){c.LoadDefaultPage()}}}})};this.OnLastPageCompleted=function(){if(!c.completion.IsCompleted()){c.config._autoPlay(false);c.ShowLastPageIncompleteMessage()}c.isNextVisualIndicator(false)};this._lastPageMessageShown=false;this.ShowLastPageIncompleteMessage=function(){if(!this._lastPageMessageShown){var d=c.lang().dict.lastPageCompleted;bootbox.confirm({message:d,buttons:{confirm:{label:c.lang().dict.yes},cancel:{label:c.lang().dict.no}},callback:function(e){if(e){c.LoadDefaultPage()}}})}this._lastPageMessageShown=true};this.OnTopicLastPageCompleted=function(e){var d=ds.utils.FormatString(c.lang().dict.topicLastPageCompleted,e);bootbox.alert({message:d,buttons:{ok:{label:c.lang().dict.ok}}})};this.isOptionsMenuItemsVisible=ko.observable(false);this.isCourseMenuItemsVisible=ko.observable(false);this.LoadPageFromNav=function(d){if(c.IsItemEnabled(d)){c.CloseMenu();c.LoadPage(d)}};this.LoadTopic=function(e){if(e.type!=="topic"&&e.type!=="mergedpages"){return false}else{var d=e.items;if(d().length>0){this.LoadPage(d()[0]);return d()[0]}else{return false}}};this.pageController=ko.observable();this.CreatePageController=function(f,d,g){var h={onPageInitialized:function(){}};$.extend(true,h,g);var i={$iframe:d,player:c,pageModel:f,loadingTimeoutDuration:this.config.pageLoadingTimeoutDuration(),onPageInitialized:h.onPageInitialized};var e=null;var j=f.type;e=CBTPlayer._pageControllers[j];if(!e){this.ShowErrorMessage("Data error: Page type '"+j+"' is not recognized.")}else{return new e(i)}};this._tempPageController=null;this._loadPageWaitForUITimeout=null;this.LoadPage=this.LoadPageByModel=function(d,f){var g={success:function(){}};$.extend(true,g,f);if(d){clearTimeout(c._loadPageWaitForUITimeout);c._loadPageWaitForUITimeout=null;if(!c._uiInitialized){c._loadPageWaitForUITimeout=setTimeout(function(){c.LoadPage(d,f)},500);return}c.Pause();c.isLoadingPage(true);c.UnloadAudio();c.pageController()&&c.pageController().OnBeforeUnload();c._tempPageController&&c._tempPageController.ClearTimeouts();var e=function(i){var h=c.config._singleFrame()&&c.$currentFrame?c.$currentFrame:c.CreateIFrame();if(c.config._singleFrame()){c.UnloadPage()}c._tempPageController=c.CreatePageController(i,h,{onPageInitialized:function(k){if(!c.config._singleFrame()){c.UnloadPage()}c.pageController(c._tempPageController);c._tempPageController=null;c.$currentFrame=h;c.$currentFrame.show();c.currentPage(i);if(i.parentId){c.currentTopic(c.currentOrg().itemsDict()[i.parentId])}else{c.currentTopic(null)}c.isPlaying(true);c.InitIdleTimeOut(h);c.InitKeyboards();if(c.config.developerMode()){c.pageController().EnableDevMode(c.enableDevControls())}g.success()}});if(c._tempPageController){var j="";if(i.type==="animatecc2017_5"){j="templates/AnimateCC2017_5.html"}else{if(i.type==="sco2004"){j="SCORMAdapter/launch_cbt.html"}else{if(i.graphicsLocation){j=i.folderPath+i.graphicsLocation}else{j=c.currentOrg().contentPath()+i.location}}}$.when(c.LoadIFrame(j,h)).done(function(){if(i.type==="sco2004"){var k=i.folderPath+i.location;var l=c.lmsAPIController.GetSCORMAdapterOptions(k);h[0].contentWindow.initSCORMAdapter(l)}i.visited(true)})}};switch(d.type){case"topic":c.LoadTopic(d);break;case"mergedpages":c.LoadTopic(d);break;case"canvas":e(d);break;case"html":case"htmlhome":case"sco2004":e(d);c.Resize();c.isLoadingPage(false)}}};this.LoadPageById=function(d,f){var g={success:function(){}};$.extend(true,g,f);if(d){var e=c.currentOrg().itemsDict()[d];c.LoadPage(e,g)}};this.LoadPageByOffset=function(f){var d=c.currentOrg().itemsList().indexOf(c.currentPage());var e=d+f;if(e<0){c.LoadPage(c.currentOrg().itemsList()[0]);return}if(e>c.currentOrg().itemsList().length-1){c.LoadPage(c.currentOrg().itemsList()[c.currentOrg().itemsList().length-1]);return}c.LoadPage(c.currentOrg().itemsList()[e])};this.LoadDefaultPage=function(){if(c.config.startPageId()){c.LoadPageById(c.config.startPageId())}else{c.LoadPage(c.currentOrg().items()[0])}};this.LoadBookmarkedPage=function(){if(c.cbt.currentPageId()){bootbox.confirm({message:c.lang().dict.continueFromBookmark,buttons:{confirm:{label:c.lang().dict.yes},cancel:{label:c.lang().dict.no}},callback:function(d){if(d){c.LoadPageById(c.cbt.currentPageId());return}else{c.LoadDefaultPage()}}})}else{c.LoadDefaultPage()}};this.UnloadPage=function(){$(document).off("mousemove click keyup",c.ActivityHandler);c.isNextVisualIndicator(false);c.DestroyFrameKeyboard();c.pageController()&&c.pageController().Unload();c.pageController(null);if(c.$currentFrame){var d=c.$currentFrame;c.$currentFrame.off();c.$currentFrame.contents().find("body").off();c.$currentFrame.contents().off();c.$currentFrame.hide();c.$currentFrame.attr("src","about:blank");c.$currentFrame.html("");if(!c.config._singleFrame()){setTimeout(function(){d.remove()},1000)}}};this.isLoadingPage=ko.observable(false);this.IndexInParent=function(e){if(e){var g=e.parentId;var f=this.currentOrg().itemsDict()[g];if(f){var d=f.items.indexOf(e);return d}}return null};this.DescendantIndexInParent=function(e,f){if(e&&f){var d=f.descendantPages().indexOf(e);return d}return null};this.IsItemEnabled=function(e){if(!e){return false}if(c.config.fastAdvance()){return true}if(e.id===c.config.startPageId()){return true}if(e.completed()){return true}var d;var h;var g=e.parentId;if(g){var f=c.currentOrg().itemsDict()[g];d=c.IndexInParent(e);if(f&&d!==null){if(d===0&&c.IsItemEnabled(f)){return true}h=f.items()[d-1];if(h&&h.completed()){return true}}}else{d=c.currentOrg().items.indexOf(e);h=c.currentOrg().items()[d-1];if(h&&h.completed()){return true}}return false};this.IsItemEnabledById=function(d){var e=c.currentOrg().itemsDict()[d];return c.IsItemEnabled(e)};this.GetItemIndexInParent=function(e){if(e){var g=e.parentId;var f=this.currentOrg().itemsDict()[g]||this.currentOrg();if(f){var d=f.items.indexOf(e)+1;return d}}return null};this.GetItemsParentLength=function(d){if(d){var f=d.parentId;var e=this.currentOrg().itemsDict()[f]||this.currentOrg();return e.items().length}return null};this.currentTopic=ko.observable();this.GetCurrentTopic=ko.pureComputed(function(){return this.currentTopic()},this);this.currentPage=ko.observable();this.GetCurrentPage=ko.pureComputed(function(){return this.currentPage()},this);this.GetItemStatusTooltip=function(d){if(!d){return}if(d.visited()&&!d.completed()){return c.lang().dict.incomplete}if(d.completed()){return c.lang().dict.completed}return c.lang().dict.notAttempted};this.currentPageIndex=ko.pureComputed(function(){var d=this.currentPage();if(d){var g=d.parentId;var f=this.currentOrg().itemsDict()[g];if(f){var e=f.items.indexOf(d)+1;return e}}return null},this);this.numParentItemPages=ko.pureComputed(function(){var d=this.currentPage();if(d){var g=d.parentId;var f=this.currentOrg().itemsDict()[g];if(f){var e=f.items().length;return e}}return null},this);this.isPlaybackToolbarVisible=ko.observable(true);this.isPlaybackVisible=ko.pureComputed(function(){if(this.currentPage()){return this.currentPage().type!=="topic"&&this.currentPage().type!=="html"}},this);this.isFirstPageInTopic=ko.pureComputed(function(){var e=this.currentPage();var f=this.currentTopic();if(!e||!f){return false}var d=f.items()[0];if(e===d){return true}else{return false}},this);this.isFirstInMultiPageTopic=ko.pureComputed(function(){var e=this.currentPage();var f=this.currentTopic();if(!e||!f){return false}if(f&&f.items().length===1){return false}var d=f.items()[0];if(e===d&&e.type!=="sco2004"){return true}else{return false}},this);this.isLastPageInTopic=ko.pureComputed(function(){var e=this.currentPage();var f=this.currentTopic();if(!e||!f){return false}var d=f.items()[f.items().length-1];if(e===d&&e.type!=="sco2004"){return true}else{return false}},this);this.$currentFrame=null;this.CreateIFrame=function(){var d=$('<iframe class="contentFrame" style="display: none;" src="" scrolling=no></iframe>').prependTo($("#contentContainer"));return d};this.LoadIFrame=function(f,d){var e=new $.Deferred();d.on("load",function(){var g=d.find("body");e.resolve()});d.attr({src:f+"?var="+new Date().getTime()});return e.promise()};this.isPlaying=ko.observable(false);this.canPlay=ko.pureComputed(function(){if(this.isLoadingPage()){return false}if(c.pageController()){return c.pageController().canPlay()}else{return !this.isPlaying()}},this);this.Play=function(){if($(".modal.in:not(.bootbox-confirm)").length){return}if(this.pageController()&&this.pageController().canPlay()){this.isPlaying(true);this.pageController().Play()}};this.canPause=ko.pureComputed(function(){if(c.pageController()){return c.pageController().canPause()}return this.isPlaying()&&!this.isLoadingPage()},this);this.Pause=function(){if(this.pageController()&&this.pageController().canPause()){this.isPlaying(false);this.pageController().Pause()}};this.isNextVisualIndicator=ko.observable();this.isForwardEnabled=ko.observable(false);this.canPlayNextPage=ko.pureComputed(function(){var d=this.currentPage();if(!d){return}var g=this.nextPage();var f=this.config.fastAdvance();var e=d.completed();var h=g&&g.completed();if(this.isLoadingPage()){return false}if(!g){return false}if(e||h||f){return true}else{return false}},this);this.PlayNextPage=function(){if(c.canPlayNextPage()){var d=c.nextPage();if(d){c.LoadPage(d)}}};this.NextPageTooltip=function(){var d=c.nextPage();if(d){return ds.utils.FormatString(c.lang().dict.nextPageTooltip,d.title)}else{return""}};this.nextPage=ko.pureComputed(function(){var d=this.currentPage();if(d){var e=this.currentOrg().pagesList().indexOf(d);var f=this.currentOrg().pagesList()[e+1];return f}return null},this);this.isBackwardEnabled=ko.observable(false);this.canPlayPreviousPage=ko.pureComputed(function(){var d=this.currentPage();if(!d){return false}var e=this.previousPage();if(this.isFirstPageInTopic()&&this.isFirstInMultiPageTopic()){return false}if(this.isLoadingPage()){return false}if(!e){return false}return true},this);this.previousPage=ko.pureComputed(function(){var d=this.currentPage();if(d){var e=this.currentOrg().pagesList().indexOf(d);if(e){var f=this.currentOrg().pagesList()[e-1];return f}}return null},this);this.PlayPreviousPage=function(){var d=c.previousPage();if(d){this.LoadPage(d)}else{this.LoadDefaultPage()}};this.PreviousPageTooltip=function(){var d=c.previousPage();if(d){return ds.utils.FormatString(c.lang().dict.previousPageTooltip,d.title)}else{return""}};this.canPlayNextSection=ko.pureComputed(function(){var d=this.currentPage();if(!d){return false}if(this.isLoadingPage()){return false}if(!c.pageController()){return false}return c.pageController().canPlayNextSection()},this);this.LoadNextSection=function(){var d=c.pageController();d.LoadNextSection&&d.LoadNextSection()};this.canReturnHome=ko.pureComputed(function(){var d=this.currentPage();if(!d){return}var g=this.nextPage();var f=this.config.fastAdvance();var e=d.completed();if(this.isLoadingPage()){return false}if(this.isFirstInMultiPageTopic()){return true}if(!g){if(d.type==="sco2004"){return false}return true}if((e||f)&&d.type!=="sco2004"){return true}else{return false}},this);this.LoadNextSection=function(){var d=c.pageController();d.LoadNextSection&&d.LoadNextSection()};this.canPlayPreviousSection=ko.pureComputed(function(){var d=this.currentPage();if(!d){return false}if(!c.pageController()){return false}if(this.isLoadingPage()){return false}return c.pageController().canPlayPreviousSection()},this);this.LoadPreviousSection=function(){var d=c.pageController();d.LoadPreviousSection&&d.LoadPreviousSection()};this.canReload=ko.pureComputed(function(){return !this.isLoadingPage()},this);this.Reload=function(){this.isPlaying(false);this.isNextVisualIndicator(false);this.pageController()&&this.pageController().Reload();this.isPlaying(true)};this.volumeLevel=ko.observable(1);this.nonMutedVolumeLevel=ko.observable(1);this.isMuted=ko.observable(false);this.audioTextEnabled=ko.observable(true);this.canAdjustVolume=ko.pureComputed(function(){return this.config.buttons.audio()&&!this.isMobile()},this);this.UnloadAudio=function(){createjs.Sound.removeAllSounds()};this.ToggleMute=function(){c.isMuted(!c.isMuted());if(c.isMuted()){c.volumeLevel(0)}else{c.volumeLevel(c.nonMutedVolumeLevel())}};this.GetVolumeCss=function(){if(c.volumeLevel()===0||c.isMuted()){return"glyphicon-volume-off"}else{return"glyphicon-volume-up"}};this.audioText=ko.pureComputed(function(){var d=this.pageController()&&this.pageController().audioText();var e=d?d.replace("pageControllerAPI","document.getElementsByClassName('contentFrame')[0].contentWindow.pageControllerAPI"):null;return e},this);this.ToggleAudioText=function(){this.audioTextEnabled(!this.audioTextEnabled());this.Resize()};this.videoProperties=ko.observable({title:"",url:"",html:""});this.ShowVideo=function(d){var e={title:"",url:"",type:"video/mp4",html:""};$.extend(true,e,d);e.html='<source src="'+e.url+'" type="'+e.type+'"><span>'+c.lang().dict.html5VideoError+"</span>";this.videoProperties(e);$("#video-modal").modal("show")};this.ShowToast=function(e){var f={text:"",expires:3000};$.extend(true,f,e);var d=$('<div class="container-fluid toast show"><div class="row"><div class="col-md-6 col-md-push-3"><div class="toast-body"><span class="glyphicon glyphicon-remove pull-right"></span><span class="message"></span></div></div></div></div>');d.find(".message").html(f.text);if(f.expires>0){d.find(".glyphicon-remove").remove();setTimeout(function(){c.HideToast(d)},f.expires)}d.find(".glyphicon-remove").on("click",function(){c.HideToast(d)});$("#toasts").append(d);return d};this.HideToast=function(d){if(!d){d=$(".toast")}d.removeClass("show");d.addClass("hide");d.remove()};this.ShowErrorMessage=function(g){var h={text:"",code:"",resolution:c.lang().dict.defaultErrorResolution};if(typeof g==="string"){h.text=g}else{$.extend(true,h,g)}var j=h.text&&"<p>"+h.text+"</p>";var e=h.code&&'<p class="small">'+c.lang().dict.errorCode+": "+h.code+"</p>";var i=h.resolution&&"<p>"+h.resolution+"</p>";var d=c.enableDevControls()?true:false;var f=bootbox.dialog({message:'<div class="errorMessage">'+c.lang().dict.errorHeading+j+e+i+"</div>",closeButton:d})};this.Alert=function(e,d){bootbox.alert({message:e,buttons:{ok:{label:c.lang().dict.ok}},callback:d})};this.isProgressActive=ko.observable(false);this.ToggleProgress=function(){c.isProgressActive(!c.isProgressActive());c.Resize()};this.ShowTranscript=function(){$("#transcript-modal").modal("show")};this.glossary=[];this.glossarySearchValue=ko.observable();this.glossaryTable=null;this.InitGlossary=function(){var f=c.config.glossaryPath();if(f){if(_.trim(f).toLowerCase().endsWith(".json")){$.getJSON(f,function(h,i,g){c.references(h)}).fail(function(){c.ShowErrorMessage("Data error: Unable to find glossary file ("+f+").")})}else{if(_.trim(f).toLowerCase().endsWith(".js")){var d=f;var e="_cbtglossary";$.when(ds.utils.LoadObjectFromScriptFile(d,e)).done(function(){c.glossary=_cbtglossary;c.glossaryTable=$("#glossaryTable").DataTable({scrollY:"calc(100vh - 240px)",scrollCollapse:false,paging:false,data:c.glossary,dom:"<<t>>",mark:true,columns:[{title:c.lang().dict.name,data:"name",defaultContent:""},{title:c.lang().dict.definition,data:"definition",defaultContent:""}]})})}}}};this.ShowGlossary=function(){$("#glossary-modal").modal("show")};this.references=ko.observableArray();this.InitReferences=function(){var f=c.config.referencesPath();if(f){if(_.trim(f).toLowerCase().endsWith(".json")){$.getJSON(f,function(h,i,g){c.references(h)}).fail(function(){c.ShowErrorMessage("Data error: Unable to find reference file ("+f+").")})}else{if(_.trim(f).toLowerCase().endsWith(".js")){var e=f;var d="_cbtreferences";$.when(ds.utils.LoadObjectFromScriptFile(e,d)).done(function(){c.references(_cbtreferences)})}}}};this.ShowReferences=function(){$("#references-modal").modal("show")};this.ShowReference=function(){$("#reference-modal").modal("show")};this.commentText=ko.observable("").extend({maxlength:255});this.canComment=ko.pureComputed(function(){var d=this.config.lmsType();if(this.lmsAPIController.type==="scorm12"||this.lmsAPIController.type==="scorm2004"){return false}return this.config.buttons.comments()},this);this.ShowComments=function(){$("#comments-modal").modal("show")};this.CloseComments=function(){$("#comments-modal").modal("hide");c.commentText("")};this.SendComments=function(){$.when(this.lmsAPIController.SendComments(this.commentText())).done(function(){c.CloseComments()})};this.ShowHelp=function(){$("#help-modal").modal("show")};this.canDesignLaunchOptions=ko.pureComputed(function(){return this.config.launchOptionsMode()},this);this.ShowLaunchOptionsDesigner=function(){$("#launchoptions-modal").modal("show")};this.ItemVisibleChange=function(f,d){var g=f.isVisible();if(g){c.InsertMenuItem(f)}else{c.RemoveMenuItem(f)}return true};this.InsertMenuItem=function(e){if(!e){return}var g=e.parentId;var f=c.currentOrg().itemsDict()[g];var d;if(f){d=f.fullItems.indexOf(e);f.items.splice(d,0,e)}else{d=c.currentOrg().fullItems.indexOf(e);c.currentOrg().items.splice(d,0,e)}c.RemoveHiddenItemsValue(e.id)};this.RemoveMenuItem=function(d){if(!d){return}var f=d.parentId;var e=c.currentOrg().itemsDict()[f];if(e){e.items.remove(d)}else{c.currentOrg().items.remove(d)}c.InsertHiddenItemsValue(d.id)};this.RemoveHiddenItemsValue=function(e){if(!e){return}var d=this.config.hiddenItems;var f=ko.utils.arrayFirst(d(),function(g){return e===g});d.remove(f)};this.InsertHiddenItemsValue=function(e){if(!e){return}var d=this.config.hiddenItems;if(!_.includes(d(),e)){d.push(e)}};this.coreVendorText=ko.observable();this.newCoreVendorText=ko.pureComputed(function(){var m=this.coreVendorText();var n=this.config.dataSourcePath();var v=this.config.logoPath();var o=this.config.dataSourceType();var l=this.config.completionType();var q=this.config.developerMode();var y=this.config.startPageId();var u=this.config.idleTimeOutMinutes();var h=this.config.buttons.language();var g=this.config.buttons.glossary();var j=this.config.buttons.reference();var f=this.config.buttons.comments();var d=this.config.buttons.audio();var e=this.config.buttons.audioText();var k=this.config.buttons.sections();var i=this.config.buttons.progress();var p=this.config.defaultOrganizationId();var w=this.config.pageLoadingTimeoutDuration();var z=this.config.topicCompletionMessages();var r=this.config.fastAdvance();var t=this.config.hiddenItems();var x="";if(c.lmsAPIController.configData){if(c.lmsAPIController.configData.dataSourcePath){x+="dataSourcePath="+n+"\r\n"}if(c.lmsAPIController.configData.logoPath){x+="logoPath="+v+"\r\n"}}if(h!==this._originalOpts.buttons.language){x+="button_language="+h.toString().toLowerCase()+"\r\n"}if(g!==this._originalOpts.buttons.glossary){x+="button_glossary="+g.toString().toLowerCase()+"\r\n"}if(j!==this._originalOpts.buttons.reference){x+="button_reference="+j.toString().toLowerCase()+"\r\n"}if(f!==this._originalOpts.buttons.comments){x+="button_comments="+f.toString().toLowerCase()+"\r\n"}if(d!==this._originalOpts.buttons.audio){x+="button_audio="+d.toString().toLowerCase()+"\r\n"}if(e!==this._originalOpts.buttons.audioText){x+="button_audioText="+e.toString().toLowerCase()+"\r\n"}if(k!==this._originalOpts.buttons.sections){x+="button_sections="+k.toString().toLowerCase()+"\r\n"}if(i!==this._originalOpts.buttons.progress){x+="button_progress="+i.toString().toLowerCase()+"\r\n"}if(l!==this._originalOpts.completionType){x+="completionType="+l.toString().toLowerCase()+"\r\n"}if(o!==this._originalOpts.dataSourceType){x+="dataSourceType="+o.toString().toLowerCase()+"\r\n"}if(q!==this._originalOpts.developerMode){x+="developerMode="+q.toString().toLowerCase()+"\r\n"}if(r!==this._originalOpts.fastAdvance){x+="fastAdvance="+r.toString().toLowerCase()+"\r\n"}if(u!==this._originalOpts.idleTimeOutMinutes){x+="idleTimeOutMinutes="+u.toString()+"\r\n"}if(w!==this._originalOpts.pageLoadingTimeoutDuration){x+="pageLoadingTimeoutDuration="+w.toString()+"\r\n"}if(y!==this._originalOpts.startPageId){x+="startPageId="+y.toString().toLowerCase()+"\r\n"}if(z!==this._originalOpts.topicCompletionMessages){x+="topicCompletionMessages="+z.toString().toLowerCase()+"\r\n"}if(ko.toJSON(t)!==ko.toJSON(this._originalOpts.hiddenItems)){x+="hiddenItems="+t.join("|")+"\r\n"}return x},this);this.CopyLaunchOptionsText=function(){var d=$("#newLaunchOptions");d.select();try{document.execCommand("copy")}catch(e){}};this.isMobile=ko.observable(false);this.ConfigureEnvironment=function(){var d=new $.Deferred();if(ds.utils.IsTouchScreen()){$.when(this.InitMobile()).done(function(){d.resolve()})}else{d.resolve()}return d.promise()};this.InitMobile=function(){var d=new $.Deferred();var e=parent.crewpad?this.lang().dict.dataLossWarningCrewpad:this.lang().dict.dataLossWarning;this.isMobile(true);$("body").addClass("mobile");this.config.buttons.audio(false);this.Alert(e,function(){setTimeout(function(){if(!createjs.Sound.initializeDefaultPlugins()){alert("create js error");d.reject();return}function f(h){createjs.Sound.removeEventListener("fileload",g);createjs.Sound.play("fake");d.resolve()}var g=createjs.proxy(f,this);createjs.Sound.alternateExtensions=["mp3"];createjs.Sound.on("fileload",g);createjs.Sound.registerSound("lib/silence-1sec.mp3","fake")},500)});return d.promise()};this.CheckExpiry=function(){var g=new Date();var d=g.toISOString().slice(0,10);var f=c.currentOrg().expiryDate();if(f&&f!==d){var e=new Date(f);if(e<g){return true}}return false};this.ShowExpiryMessage=function(e){var d=bootbox.dialog({message:'<div class="errorMessage"><h1>CBT course has expired.</h1><p>Please contact your administrator.</p></div>',closeButton:false})};this._initialized=false;this._uiInitialized=false;this.Init=function(){var d=new $.Deferred();this.InitEventHandlers();this.InitSubscriptions();$.when(c.InitLMSAPI()).done(function(){c.InitPlayerConfig();$.when(c.InitUI()).done(function(){$.when(c.InitUiLang()).done(function(){$.when(c.ConfigureEnvironment()).done(function(){c.InitGlossary();c.InitReferences();var e=c.InitDataSource(c.config.dataSourceType());if(!e){d.reject();return}$.when(e.LoadData()).done(function(){c.InitOrganizations();function h(){c.LoadBookmarkedPage();setTimeout(function(){$("#appLoader").fadeOut()},1000);c._initialized=true;$(c).triggerHandler(c._events.initialized);d.resolve()}function g(){setTimeout(function(){c.isLMSContentProtection(true);$("#appLoader").fadeOut();d.reject()},2000)}if(c.CheckExpiry()){c.ShowExpiryMessage();return}var f=arguments;c.InitCompletion();c.lmsAPIController.ApplySuspendData();if(c._doShowLMSWarning){if(c.config.lmsContentProtection()){g()}else{c.Alert(c.lang().dict.noLmsWarning,function(){h()})}}else{h()}})})});ko.applyBindings(c);setTimeout(function(){$("#hiderendering").hide();$("body").css("overflow","auto")},500)})});return d.promise()};this.InitEventHandlers=function(){$(window).on("resize",function(){c.Resize()});$("#glossary-modal").on("shown.bs.modal",function(){c.glossaryTable&&c.glossaryTable.columns&&c.glossaryTable.columns.adjust()});$("#glossary-modal").on("hidden.bs.modal",function(){c.glossarySearchValue("")});$("#comments-modal").on("shown.bs.modal",function(){$("#commentText").focus()});$("#video-modal").on("hidden.bs.modal",function(){c.videoProperties({title:"",url:"",html:""});var e=$("#video1")[0];e&&e.load&&e.load()});$("#about-modal").on("hidden.bs.modal",function(){c.videoProperties({title:"",url:"",html:""});var e=$("#video1")[0];e&&e.load&&e.load()});$(".modal").on("hidden.bs.modal",function(){c.Play()});this.on(this._events.pageInitTimedOut,function(){c.isLoadingPage(false)});this.on(this._events.pageLoadedTimedOut,function(){c.isLoadingPage(false)});Mousetrap.bind("f5",function(){c._f5=true});var d=$("#glossary-modal, #references-modal, #about-modal, #comments-modal, #language-modal, #g-modal, #devreport-modal, #transcript-modal");d.on("show.bs.modal",function(){c.Pause()});d.on("hide.bs.modal",function(){c.Play()});this.InitVisibilityHandler();$(window).on("beforeunload unload pagehide",function(){$(window).off("beforeunload unload pagehide");c.Exit()})};this._doResumeAfterVisibilityChange=false;this.InitVisibilityHandler=function(){var d,e;if(typeof document.hidden!=="undefined"){d="hidden";e="visibilitychange"}else{if(typeof document.msHidden!=="undefined"){d="msHidden";e="msvisibilitychange"}else{if(typeof document.webkitHidden!=="undefined"){d="webkitHidden";e="webkitvisibilitychange"}}}$(document).on("visibilitychange",function(){if(document[d]){if(c.isPlaying()){c._doResumeAfterVisibilityChange=true}if(c.isPlaying()){c.Pause()}}else{if(c._doResumeAfterVisibilityChange){if(!c.isPlaying()){c.Play()}}c._doResumeAfterVisibilityChange=false}})};this.InitSubscriptions=function(){this.ui.subscribe(function(d){c._uiInitialized=false});this.currentPage.subscribe(function(d){if(d){c.cbt.currentPageId(d.id)}else{c.cbt.currentPageId(null)}});this.volumeLevel.subscribe(function(d){createjs.Sound.setVolume(d)});this.glossarySearchValue.subscribe(function(d){if(d!==undefined&&c.glossaryTable){c.glossaryTable.search(d).draw()}});c.config.developerMode.subscribe(function(d){if(d){c.enableDevControls(true);c.InitKeyboards()}else{c.enableDevControls(false);c.DisableAllKeyboards()}});c.config.developerMode.valueHasMutated();c.enableDevControls.subscribe(function(d){if(!d){c.DisableAllKeyboards()}else{c.EnableKeyboards([c._defaultKeyboard,c._frameKeyboard])}});c.config._autoPlay.subscribe(function(d){if(d){c.config.fastAdvance(true)}});c.config._autoPlay.valueHasMutated();c.currentOrg.subscribe(function(d){d.completionStatus.subscribe(function(e){if(e==="completed"&&c._initialized){c.config._autoPlay(false);c.isNextVisualIndicator(false);c.ShowCourseCompletedMessage()}});d.itemsFilter.subscribe(function(e){c.ClearSelectedCourseItem()})})};this.idleInterval=null;this.currentIdleSeconds=ko.observable(0);this.isTimeOut=ko.observable(false);this.InitIdleTimeOut=function(e){var d=$(document);d.off("mousemove click keyup",this.ActivityHandler);clearInterval(this.idleInterval);this.isTimeOut(false);var f=this.config.idleTimeOutMinutes()*60;this.currentIdleSeconds(0);if(f){d.on("mousemove click keyup",this.ActivityHandler);e.contents().on("mousemove",this.ActivityHandler);this.idleInterval=setInterval(function(){if(!c.config.developerMode()){c.currentIdleSeconds(c.currentIdleSeconds()+1);if(c.currentIdleSeconds()>=f){clearInterval(c.idleInterval);d.off("mousemove click keyup",c.ActivityHandler);e.contents().off("mousemove",c.ActivityHandler);c.ShowIdleWarning()}}},1000)}};this.ActivityHandler=function(){c.currentIdleSeconds(0)};this.ShowIdleWarning=function(){c.Pause();var i=this.config.idleTimeOutMinutes();var f=ko.observable(59);var g=setInterval(function(){f(f()-1)},1000);var e=setTimeout(function(){c.isTimeOut(true);clearInterval(g);clearTimeout(e);bootbox.hideAll();c.Exit()},60000);var h=ds.utils.FormatString(c.lang().dict.idleWarning,i);var d=bootbox.confirm({message:h,buttons:{confirm:{label:c.lang().dict.ok},cancel:{label:c.lang().dict.cancel}},callback:function(j){if(j){clearInterval(g);clearTimeout(e);c.isTimeOut(true);c.Exit()}else{clearInterval(g);clearTimeout(e);c.InitIdleTimeOut(c.$currentFrame);c.Play()}}});ko.applyBindings(f,d[0])};this.isClosed=ko.observable(false);this.isLMSContentProtection=ko.observable(false);this._readyToExit=false;this.onExit=function(){};this.Exit=function(){c.UnloadAudio();c.CloseAllModals();if(c._initialized&&!c.isClosed()){c.lmsAPIController.Exit();c.isClosed(true)}c.UnloadPage();c.onExit()};this.ClosePlayer=function(){c.Pause();bootbox.confirm({message:c.lang().dict.exitMessage,buttons:{confirm:{label:c.lang().dict.ok},cancel:{label:c.lang().dict.cancel}},callback:function(d){if(d){c.Exit()}else{c.Play()}}})};this._events={initialized:"cbtplayer.initialized",pageLoaded:"cbtplayer.pageLoaded",pageCompleted:"cbtplayer.pageCompleted",pageInitTimedOut:"cbtplayer.pageInitTimedOut",pageLoadedTimedOut:"cbtplayer.pageLoadedTimedOut"};this.on=function(e,d){$(c).on(e,d)};this.off=function(e,d){$(c).off(e,d)};this.trigger=function(e,d){$(c).triggerHandler(e,d)};this._devClicks=0;this._devTimeout=null;this.enableDevControls=ko.observable(false);this.DevClick=function(){if(!c.config.developerMode()){if(c._devClicks===null){c._devTimeout=setTimeout(function(){c._devClicks=null;c._devClicks=0},4000)}if(c._devClicks>=10){c.config.developerMode(true);c._devClicks=0;$("#about-modal").modal("hide");c.Alert("Developer mode unlocked!")}else{c._devClicks++}}};this.ToggleDevControls=function(){c.enableDevControls(!c.enableDevControls());c.pageController()&&c.pageController().EnableDevMode(c.enableDevControls())};this.ShowDeveloperHelp=function(){$("#developerhelp-modal").modal("show")};this._DevToggleGraphicsQuality=function(){var d=["auto","low","med","hi"];var e=c.config._canvasGraphicsQuality;return function(){e(d[(d.indexOf(e())+1)%4])}}();this._DevToggleFastAdvance=function(){var d=c.config.fastAdvance;d(!d())};this._DevTogglePlaySpeed=function(){var d=c.config._playSpeed()*2;if(d<=16){c.config._playSpeed(d)}else{c.config._playSpeed(1)}c.LoadPage(c.currentPage())};this._DevToggleAutoPlay=function(){var d=c.config._autoPlay;d(!d());c.LoadPage(c.currentPage())};this._courseTable=null;this.DevInitCourseTable=function(){var d=ko.toJS(c.currentOrg().itemsList());if(!$.fn.DataTable.isDataTable("#courseTable")){this._courseTable=$("#courseTable").DataTable({paging:false,dom:'<<"pull-left"f><"pull-right"B><"pull-right"i><t>>',data:d,mark:true,order:[],buttons:[{extend:"csv",title:"Data export"}],columns:[{title:"Completed",data:"completed",defaultContent:""},{title:"Id",data:"id",render:function(e,h,f,g){return'<a href="#" class="load">'+e+"</a>"},defaultContent:""},{title:"Title",data:"title",defaultContent:""},{title:"Type",data:"type",defaultContent:""},{title:"Time",data:"learningTime",searchable:false,render:function(e,h,f,g){return ds.utils.GetTimeInterval(e)},defaultContent:""}]});this._courseTable.on("click","a.load",function(e,f,g){var h=c._courseTable.row($(this).parents("tr")).data();c.LoadPageById(h.id);$("#devreport-modal").modal("hide")})}else{this._courseTable.clear();this._courseTable.rows.add(d);this._courseTable.draw()}};this.ShowDeveloperReport=function(){$("#devreport-modal").modal("show");c.DevInitCourseTable()};this.InitKeyboards=function(){c.InitDefaultKeyboard();c.InitCourseMenuKeyboard();c.InitOptionsMenuKeyboard();c.InitFrameKeyboard()};this.DisableAllKeyboards=function(){this._courseMenuKeyboard&&this._courseMenuKeyboard.pause();this._optionsMenuKeyboard&&this._optionsMenuKeyboard.pause();this._defaultKeyboard&&this._defaultKeyboard.pause();this._frameKeyboard&&this._frameKeyboard.pause()};this.EnableKeyboards=function(d){this.DisableAllKeyboards();$.each(d,function(e,f){f&&f.unpause()})};this._defaultKeyboard;this.InitDefaultKeyboard=function(){if(this._defaultKeyboard){return}this._defaultKeyboard=new Mousetrap();this._InitCommonKeyboard(this._defaultKeyboard)};this._InitCommonKeyboard=function(d){d.bind("space",function(f){if(c.isPlaying()){c.Pause()}else{c.Play()}f.preventDefault()});d.bind("ctrl+right",function(f){if(c.currentPage().type!=="htmlhome"&&!c.isLastPageInTopic()){c.PlayNextPage()}f.preventDefault()});d.bind("ctrl+left",function(f){if(c.currentPage().type!=="htmlhome"&&!c.isFirstPageInTopic()){c.PlayPreviousPage()}f.preventDefault()});if(c.config.developerMode()){d.bind(["ctrl+f12"],function(f){c.ToggleDevControls();f.preventDefault()});d.bind(["ctrl+m","`"],function(f){c.ShowMenu();f.preventDefault()});d.bind(["o"],function(f){c.ShowOptionsMenu();f.preventDefault()});d.bind("h",function(f){c.LoadDefaultPage();f.preventDefault()});d.bind("r",function(f){c.Reload();f.preventDefault()});d.bind("m",function(f){c.ToggleMute();f.preventDefault()});d.bind("alt+right",function(f){c.LoadNextSection();f.preventDefault()});d.bind("alt+left",function(f){c.LoadPreviousSection();f.preventDefault()});d.bind("c",function(f){c.ToggleAudioText();f.preventDefault()})}};this._frameKeyboard;this.InitFrameKeyboard=function(){this.DestroyFrameKeyboard();if(c.pageController()&&c.pageController().framewindow){try{this._frameKeyboard=new Mousetrap(c.pageController().framewindow);this._InitCommonKeyboard(this._frameKeyboard)}catch(d){}}};this.DestroyFrameKeyboard=function(){if(this.pageController()&&this.pageController().framewindow&&this._frameKeyboard){this._frameKeyboard.reset();this._frameKeyboard=null}};this._courseMenuKeyboard;this._selectedCourseItem;this.OnSearchKeyup=function(f,g){var h=1;var d=g.which||g.keyCode;if(d===40){$(g.target).blur();setTimeout(function(){c._courseMenuKeyboard.trigger("down")},1)}if(d===27){c.CloseMenu()}};this.ClearSelectedCourseItem=function(){c._selectedCourseItem&&c._selectedCourseItem.selected(false);c._selectedCourseItem=null};this.ClearCourseItemFilter=function(){c.currentOrg().itemsFilter(null)};this.SelectCourseItem=function(d){c.ClearSelectedCourseItem();c._selectedCourseItem=d;c._selectedCourseItem.selected(true)};ko.bindingHandlers.setFocus={update:function(h,l,e){var k=ko.unwrap(l());if(k.selected()){var d=$(h).closest(".cmenu-items");var f=d.get(0);var i=h.getBoundingClientRect().top-f.getBoundingClientRect().top;var g=h.getBoundingClientRect().bottom-f.getBoundingClientRect().bottom;var j=(i>=0)&&(g<=0);if(!j){if(Math.abs(g)<Math.abs(i)){h.scrollIntoView(false)}else{h.scrollIntoView(true)}}}}};this.InitCourseMenuKeyboard=function(){if(this._courseMenuKeyboard){return}this._courseMenuKeyboard=new Mousetrap();this._courseMenuKeyboard.bind(["esc"],function(){c.CloseMenu()});this._courseMenuKeyboard.bind(["ctrl+m","`"],function(d){c.ClearSelectedCourseItem();$("#search").focus();d.preventDefault()});this._courseMenuKeyboard.bind("down",function(d){var i;var h;var g=_.trim(c.currentOrg().itemsFilter());if(!c._selectedCourseItem&&!g){c.SelectCourseItem(c.currentPage())}else{if(g){i=c.currentOrg().filteredItemsList()}else{if(c._selectedCourseItem&&c._selectedCourseItem.type==="topic"&&!c._selectedCourseItem.isItemsVisible()){i=c.currentOrg().topicsList()}else{i=c.currentOrg().itemsList()}}var f=i.indexOf(c._selectedCourseItem);var j=f+1;if(j>i.length-1){h=i[i.length-1]}else{h=i[j]}c.SelectCourseItem(h)}d.preventDefault&&d.preventDefault()});this._courseMenuKeyboard.bind("up",function(d){var h;var g;if(!c._selectedCourseItem){c._selectedCourseItem=c.currentPage()}if(_.trim(c.currentOrg().itemsFilter())){h=c.currentOrg().filteredItemsList()}else{h=c.currentOrg().itemsList()}var f=h.indexOf(c._selectedCourseItem);var i=f-1;if(i<0){g=h[0]}else{g=h[i]}if(!_.trim(c.currentOrg().itemsFilter())&&g.type!=="topic"&&g.parentId){var j=c.currentOrg().itemsDict()[g.parentId];if(!j.isItemsVisible()){g=j}}c.SelectCourseItem(g);d.preventDefault()});this._courseMenuKeyboard.bind("pagedown",function(d){var g;var f;if(_.trim(c.currentOrg().itemsFilter())){g=c.currentOrg().filteredItemsList()}else{g=c.currentOrg().itemsList()}f=g[g.length-1];if(f.parentId){c.currentOrg().itemsDict()[f.parentId].isItemsVisible(true)}c.SelectCourseItem(f);d.preventDefault()});this._courseMenuKeyboard.bind("pageup",function(d){var g;var f;if(_.trim(c.currentOrg().itemsFilter())){g=c.currentOrg().filteredItemsList()}else{g=c.currentOrg().itemsList()}f=g[0];if(f.parentId){c.currentOrg().itemsDict()[f.parentId].isItemsVisible(true)}c.SelectCourseItem(f);d.preventDefault()});this._courseMenuKeyboard.bind("ctrl+down",function(d){var f=_.trim(c.currentOrg().itemsFilter());var i;if(c._selectedCourseItem&&!f){if(c._selectedCourseItem.type==="topic"){i=c._selectedCourseItem}else{if(c._selectedCourseItem.parentId){i=c.currentOrg().itemsDict()[c._selectedCourseItem.parentId]}}if(i){i.isItemsVisible(true);var h=i.items();var g=h[h.length-1];c.SelectCourseItem(g)}}d.preventDefault()});this._courseMenuKeyboard.bind("ctrl+up",function(d){var f=_.trim(c.currentOrg().itemsFilter());var i;if(c._selectedCourseItem&&!f){if(c._selectedCourseItem.type==="topic"){i=c._selectedCourseItem}else{if(c._selectedCourseItem.type!=="topic"&&c._selectedCourseItem.parentId){i=c.currentOrg().itemsDict()[c._selectedCourseItem.parentId]}}if(i){i.isItemsVisible(true);var h=i.items();var g=h[0];c.SelectCourseItem(g)}}d.preventDefault()});this._courseMenuKeyboard.bind("ctrl+right",function(d){var f=_.trim(c.currentOrg().itemsFilter());if(!f){$.each(topic=c.currentOrg().topicsList(),function(e,g){g.isItemsVisible(true)});c.SelectCourseItem(c._selectedCourseItem);d.preventDefault()}});this._courseMenuKeyboard.bind("ctrl+left",function(d){var f=_.trim(c.currentOrg().itemsFilter());if(!f){$.each(topic=c.currentOrg().topicsList(),function(e,g){g.isItemsVisible(false)});c.SelectCourseItem(c.currentOrg().itemsList()[0]);d.preventDefault()}});this._courseMenuKeyboard.bind("left",function(d){var f=_.trim(c.currentOrg().itemsFilter());if(c._selectedCourseItem&&!f){if(c._selectedCourseItem.type==="topic"){c._selectedCourseItem.isItemsVisible(false)}else{var g=c.currentOrg().itemsDict()[c._selectedCourseItem.parentId];c.SelectCourseItem(g);c._selectedCourseItem.isItemsVisible(false)}}d.preventDefault()});this._courseMenuKeyboard.bind("right",function(d){var f=_.trim(c.currentOrg().itemsFilter());if(c._selectedCourseItem&&!f){if(c._selectedCourseItem.type==="topic"){c._selectedCourseItem.isItemsVisible(true)}}d.preventDefault()});this._courseMenuKeyboard.bind("enter",function(d){if(c._selectedCourseItem){if(c._selectedCourseItem.type==="topic"){c._selectedCourseItem.isItemsVisible(!c._selectedCourseItem.isItemsVisible())}else{c.LoadPageFromNav(c._selectedCourseItem)}}d.preventDefault()});this._courseMenuKeyboard.pause()};this._optionsMenuKeyboard;this.InitOptionsMenuKeyboard=function(){if(this._optionsMenuKeyboard){return}this._optionsMenuKeyboard=new Mousetrap();this._optionsMenuKeyboard.bind(["esc"],function(){c.CloseOptionsMenu()});this._optionsMenuKeyboard.pause()};this.GClick=function(){}}CBTPlayer._dataSourceControllers={};CBTPlayer._pageControllers={};CBTPlayer._lmsApiControllers={};CBTPlayer._completionControllers={};CBTPlayer._dataSources={};CBTPlayer._userInterfaces={};CBTPlayer.RegisterPageController=function(b,a){if(!CBTPlayer._pageControllers[b]){CBTPlayer._pageControllers[b]=a}};CBTPlayer.RegisterLMSAPIController=function(b,a){if(!CBTPlayer._lmsApiControllers[b]){CBTPlayer._lmsApiControllers[b]=a}};CBTPlayer.RegisterCompletionController=function(b,a){if(!CBTPlayer._completionControllers[b]){CBTPlayer._completionControllers[b]=a}};CBTPlayer.RegisterDataSource=function(b,a){if(!CBTPlayer._dataSources[b]){CBTPlayer._dataSources[b]=a}};CBTPlayer.RegisterUserInterface=function(a,b){if(!CBTPlayer._userInterfaces[a]){CBTPlayer._userInterfaces[a]=b}};function DataSourceBase(a){var c=this;var b={_className:"DataSourceBase",type:null,player:null,src:null,model:null,hiddenItems:[],onLoaded:function(){}};b=ds.utils.Merge(b,a);this._className=b._className;this.type=b.type;if(!b.player){throw new Error("Player instance is missing.")}this.player=b.player;if(!b.model){throw new Error("Model is missing.")}this.model=b.model;if(!b.src){throw new Error("src is missing.")}this.src=b.src;this.hiddenItems=b.hiddenItems;this.onLoaded=b.onLoaded;this.LoadData=function(){}};function CBTItemXMLParser(a){var c=this;var b={player:null,model:null};$.extend(true,b,a);if(!b.player){throw new Error("Player instance is missing.")}this.player=b.player;if(!b.model){throw new Error("Model is missing.")}this.model=b.model;this._className="CBTItemXMLParser";this.ParseXML=function(e){var d=new $.Deferred();$.ajax({type:"GET",url:e,dataType:"xml",error:function(g,h,f){c.player.ShowErrorMessage({text:"Unable to find "+e,code:PlayerConstants.ErrorCodes.LOAD_PAGE_XML});d.reject(g,h,f)},success:function(f){c.LoadModelFromXML(f);d.resolve(c.model)}});return d.promise()};this.LoadModelFromXML=function(f){if(!f){return}var d=$(f);var e=this.model;e.graphicsLocation=ds.utils.Trim(d.find("graphics_location").text());e.data=ds.utils.ParseJSON(ds.utils.Trim(d.find("data").text()));d.find("sections > section").each(function(){var g=$(this);var h=new CBTPageSectionModel();h.id=ds.utils.Trim(g.find("id").text());h.audioLocation=ds.utils.Trim(g.find("audio_location").text());h.audioText=ds.utils.Trim(g.find("audio_text").text());h.instruction=ds.utils.Trim(g.find("instruction").text());h.completion=ds.utils.Trim(g.find("completion").text());h.advance=ds.utils.Trim(g.find("advance").text());e.sections.push(h)})}};function CBTStructureXMLParser(a){var c=this;var b={_className:"CBTStructureXMLParser",type:"xml"};$.extend(true,b,a);DataSourceBase.call(this,b);this.LoadData=function(){var e=new $.Deferred();var d=null;$.ajax({type:"GET",url:this.src,error:function(g,h,f){c.player.ShowErrorMessage({code:PlayerConstants.ErrorCodes.LOAD_CBT_XML});e.reject(g,h,f)},success:function(g,f){d=c.LoadModelFromXML(g);$.when(d).done(function(){e.resolve(c.model)})}});return e.promise()};this.LoadModelFromXML=function(k){var e=$(k);var f=this.model;var i=new $.Deferred();var j=[];var h=e.find("organizations").attr("id");if(!h){h=this.src}f.id(h);var g=e.find("organizations").attr("default");if(!g){g=e.find("organization:first").attr("id")}f.defaultOrganizationId(g);var d=e.find("organization");d.each(function(l){j.push(c.GetOrganization($(this)))});$.when.apply($,j).then(function(){var l=arguments;f.organizations(Array.prototype.slice.call(l));i.resolve()});return i.promise()};this.GetOrganization=function(d){var i=new $.Deferred();var k=[];var j=new CBTOrganizationModel();j.id=d.attr("id");j.language(ds.utils.Trim(d.find("metadata language").text()));j.description=ds.utils.Trim(d.find("metadata description").text());j.rights=ds.utils.Trim(d.find("metadata rights").text());j.title=ds.utils.Trim(d.find("> title").text());j.date(ds.utils.Trim(d.find("metadata date").text()));j.expiryDate(ds.utils.Trim(d.find("metadata expiry_date").text()));var f=ds.utils.Trim(d.find("metadata content_folder").text());var e=f.slice(f.indexOf(":")+1)+"/";j.contentPath(e);var g=[];var h=[];d.find("> item").each(function(){var l=j.contentPath();var m=c.GetItemNodeFromXML($(this),l);if(m){k.push(m.promise);g.push(m.model);if(m.model.isVisible()){h.push(m.model)}}});j.fullItems(g);j.items(h);$.when.apply($,k).then(function(){var l=arguments;i.resolve(j)});return i.promise()};this.GetItemNodeFromXML=function(d,e,n){var h;var k=new $.Deferred();var o=[];var g=d.attr("id");var p=d.attr("itemtype");switch(p){case"topic":case"mergedpages":h=new CBTTopicModel();break;default:h=new CBTItemModel()}h.id=g;h.parentId=n;h.type=p;var j=d.attr("location");if(j){h.location=j;h.folderPath=e+j.substring(0,j.lastIndexOf("/")+1)}h.completion=d.attr("completion");h.title=d.find("> title").text();var l=ko.utils.arrayFirst(this.hiddenItems,function(q){return g===q});if(l){h.isVisible(false)}else{h.isVisible(true)}var m=new CBTItemXMLParser({player:c.player,model:h});if(j){if(j.toLowerCase().endsWith(".html")){}else{o.push(m.ParseXML(e+h.location))}}var f=[];var i=[];d.find("> item").each(function(){var q=c.GetItemNodeFromXML($(this),e,h.id);if(q){o.push(q.promise);f.push(q.model);if(q.model.isVisible()){i.push(q.model)}}});h.fullItems(f);h.items(i);$.when.apply($,o).then(function(){var q=arguments;k.resolve()});return{promise:k.promise(),model:h}}}CBTPlayer.RegisterDataSource("xml",CBTStructureXMLParser);function CBTStructureJSONParser(a){var c=this;var b={_className:"CBTStructureJSONParser",type:"json"};$.extend(true,b,a);DataSourceBase.call(this,b);this.LoadData=function(){var d=new $.Deferred();$.getJSON(this.src,function(f,g,e){c.model.SetModel(f);ko.utils.arrayForEach(c.model.organizations(),function(h){ko.utils.arrayForEach(h.fullItems(),function(i){c.InsertFullItemToItems(h,i)})});d.resolve(c.model)}).fail(function(f,g,e){c.player.ShowErrorMessage({code:PlayerConstants.ErrorCodes.LOAD_CBT_JSON});d.reject(f,g,e)});return d.promise()};this.InsertFullItemToItems=function(g,d){if(!g&&!d){return}var i=d.parentId;var h=g.fullItemsDict()[i];var e;var f=ko.utils.arrayFirst(this.hiddenItems,function(j){return d.id===j});if(f){d.isVisible(false)}else{d.isVisible(true)}ko.utils.arrayForEach(d.fullItems(),function(j){c.InsertFullItemToItems(g,j)});if(d.isVisible()){if(h){e=h.fullItems.indexOf(d);h.items.splice(e,0,d)}else{e=g.fullItems.indexOf(d);if(e>=0){g.items.splice(e,0,d)}}}}}CBTPlayer.RegisterDataSource("json",CBTStructureJSONParser);function CBTStructureSCO2004Parser(a){var c=this;var b={_className:"CBTStructureSCO2004Parser",type:"sco2004"};$.extend(true,b,a);DataSourceBase.call(this,b);this.LoadData=function(){var e=new $.Deferred();var d=null;$.ajax({type:"GET",url:this.src,error:function(g,h,f){c.player.ShowErrorMessage({code:PlayerConstants.ErrorCodes.LOAD_CBT_SCO2004});e.reject(g,h,f)},success:function(g,f){d=c.LoadModelFromXML(g);$.when(d).done(function(){e.resolve(c.model)})}});return e.promise()};this.LoadModelFromXML=function(n){var f=$(n);var g=this.model;var j=new $.Deferred();var k=[];var e=f.find("resources > resource");var l={};e.each(function(){var o=$(this).attr("identifier");if(o){l[o]=$(this)}});var i=f.find("organizations").attr("identifier");if(!i){i=this.src}g.id(i);var h=f.find("organizations").attr("default");if(!h){var m=f.find("organization");h=m.find("organization").attr("identifier")}g.defaultOrganizationId(h);var d=f.find("organization");d.each(function(o){k.push(c.GetOrganization($(this),l))});$.when.apply($,k).then(function(){var o=arguments;g.organizations(Array.prototype.slice.call(o));j.resolve()});return j.promise()};this.GetOrganization=function(d,l){var h=new $.Deferred();var k=[];var i=new CBTOrganizationModel();var e=c.player.config.dataSourcePath();i.id=d.attr("identifier");i.language("EN");i.description=null;i.rights=null;i.title=ds.utils.Trim(d.find("> title").text());i.date(null);i.expiryDate(c.player.config.dataSourcePath());i.contentPath(e);var f=[];var g=[];var j=e.substring(0,e.lastIndexOf("/")+1);d.find("> item").each(function(){var m=c.GetItemNodeFromXML($(this),j,l);if(m){k.push(m.promise);f.push(m.model);if(m.model.isVisible()){g.push(m.model)}}});i.fullItems(f);i.items(g);$.when.apply($,k).then(function(){var m=arguments;h.resolve(i)});return h.promise()};this.GetItemNodeFromXML=function(d,n,r,o){var h;var k=new $.Deferred();var p=[];var g=d.attr("identifier");var q=d.attr("identifierref");var m=d.attr("parameters")?d.attr("parameters"):"";var s=r[q];switch(q){case undefined:case null:h=new CBTTopicModel();break;default:h=new CBTItemModel()}h.id=g;h.parentId=o;h.type=s?"sco2004":"topic";var e=s?s.attr("href"):"";var j=e+m;if(j){h.location=j;h.folderPath=n}h.completion=d.attr("completion");h.title=d.find("> title").text();var l=ko.utils.arrayFirst(this.hiddenItems,function(t){return g===t});if(l){h.isVisible(false)}else{h.isVisible(true)}var f=[];var i=[];d.find("> item").each(function(){var t=c.GetItemNodeFromXML($(this),n,r,h.id);if(t){p.push(t.promise);f.push(t.model);if(t.model.isVisible()){i.push(t.model)}}});if(f.length===0&&h.type==="topic"){k.resolve();return null}h.fullItems(f);h.items(i);$.when.apply($,p).then(function(){var t=arguments;k.resolve()});return{promise:k.promise(),model:h}}}CBTPlayer.RegisterDataSource("sco2004",CBTStructureSCO2004Parser);function CBTStructureJSParser(a){var c=this;var b={_className:"CBTStructureJSParser",type:"js"};$.extend(true,b,a);DataSourceBase.call(this,b);this.dataVarName=c.player.config.dataVariable();this.LoadData=function(){var d=new $.Deferred();$.when(ds.utils.LoadObjectFromScriptFile(c.src,this.dataVarName)).done(function(){var e=window[c.dataVarName];if(e){c.model.SetModel(e);ko.utils.arrayForEach(c.model.organizations(),function(f){ko.utils.arrayForEach(f.fullItems(),function(g){c.InsertFullItemToItems(f,g)})});d.resolve(c.model)}else{c.player.ShowErrorMessage({code:PlayerConstants.ErrorCodes.LOAD_CBT_GLOBALVARIABLE});d.reject()}}).fail(function(){c.player.ShowErrorMessage({code:PlayerConstants.ErrorCodes.LOAD_CBT_JAVASCRIPT});d.reject()});return d.promise()};this.InsertFullItemToItems=function(g,d){if(!g&&!d){return}var i=d.parentId;var h=g.fullItemsDict()[i];var e;var f=ko.utils.arrayFirst(this.hiddenItems,function(j){return d.id===j});if(f){d.isVisible(false)}else{d.isVisible(true)}ko.utils.arrayForEach(d.fullItems(),function(j){c.InsertFullItemToItems(g,j)});if(d.isVisible()){if(h){e=h.fullItems.indexOf(d);h.items.splice(e,0,d)}else{e=g.fullItems.indexOf(d);if(e>=0){g.items.splice(e,0,d)}}}}}CBTPlayer.RegisterDataSource("js",CBTStructureJSParser);function CBTObject(a){var c=this;var b={_className:"CBTObject",type:"object"};$.extend(true,b,a);DataSourceBase.call(this,b);this.LoadData=function(){var f=new $.Deferred();var e=null;var g=window[this.src];var d=new CBTStructureModel(g);f.resolve(c.model);return f.promise()}}CBTPlayer.RegisterDataSource("object",CBTObject);function PageControllerBase(b){var d=this;var a;var c={$iframe:null,player:null,pageModel:null,loadingTimeoutDuration:30,onPageInitialized:function(){}};$.extend(true,c,b);this.pcbid;if(!c.pageModel){throw new Error("Page model is missing.")}this.pageModel=c.pageModel;if(!c.player){throw new Error("Player instance is missing.")}this.player=c.player;this.audioText=ko.observable();this.transcriptText=ko.observable();this.onPageInitialized=c.onPageInitialized;this._timeoutBeforePageInit=null;this._timeoutPageLoaded=null;this._isDeveloperMode=ko.observable(false);this._autoPlayTimeout=null;this.loadingTimeoutDuration=c.loadingTimeoutDuration;this.startTimestamp=null;this.canPlayNextSection=function(){return false};this.canPlayPreviousSection=function(){return false};if(!c.$iframe){throw new Error("$iframe is missing.")}this.$frame=c.$iframe;this.framewindow=null;if(this.$frame[0]){this.framewindow=this.$frame[0].contentWindow?this.$frame[0].contentWindow:this.$frame[0].contentDocument.defaultView}this.Resize=function(){};this.canPlay=function(){return false};this.Play=function(){d.trigger(d._events.play)};this.canPause=function(){return false};this.Pause=function(){d.trigger(d._events.pause)};this.Reload=function(){};this.Stop=function(){};this.ShowVideo=function(e){var f={title:"",url:"",type:"video/mp4"};$.extend(true,f,e);if(f.url.indexOf("http://")===0||f.url.indexOf("https://")===0){}else{f.url=d.player.currentOrg().contentPath()+f.url}d.player.ShowVideo(f)};this.SetPageCompletion=function(e){var j=d.player.currentOrg().itemsDict()[d.pageModel.parentId];var l=j?j.completed():true;var h=j?j.items()[j.items().length-1]:null;e=e===true?true:false;d.pageModel.completed(e);var k=j?j.completed():false;if(parent.crewpad&&e){d.player.SaveCBTData()}if(d.player.config._autoPlay()){d.player.PlayNextPage()}var g=d.player.currentOrg().itemsList();var f=g.indexOf(d.pageModel);if(f===g.length-1){d.player.OnLastPageCompleted()}else{if(d.player.config.topicCompletionMessages()&&!d.player.config._autoPlay()){if(!l&&k&&d.player.currentOrg().completionStatus()!=="completed"){var m=d.player.currentOrg().topicsList();f=m.indexOf(j);var i=f===m.length-1?null:m[f+1]}else{if(!k&&d.pageModel===h){d.player.OnTopicLastPageCompleted(j.title)}}}}};this._initialized=false;this._completedSubscription;this.OnBeforePageInit=function(){clearTimeout(d._timeoutBeforePageInit)};this.OnPageLoaded=function(){clearTimeout(d._timeoutPageLoaded);d.startTimestamp=Date.now();if(d.framewindow){d.PostMessage(d.framewindow,"keyboardf5")}if(d.player.config._autoPlay()&&d.player.config._autoPlaySkipTimeout()){d._autoPlayTimeout=setTimeout(function(){if(d.player.config._autoPlay()){d.player.PlayNextPage()}},d.player.config._autoPlaySkipTimeout()*1000)}d._completedSubscription=d.pageModel.completed.subscribe(function(e){if(d.player.currentOrg().completionStatus()==="completed"){d.player.isNextVisualIndicator(false)}else{d.player.isNextVisualIndicator(e)}d.player.trigger(d.player._events.pageCompleted,{item:d.pageModel})});d._initialized=true;d.player.trigger(d.player._events.pageLoaded,{item:d.pageModel});d.player.isPlaybackToolbarVisible(true)};this.OnBeforeUnload=function(){if(a){d.player.config.contentContainerBackgroundColor(a)}d.ClearTimeouts();window.removeEventListener("message",this.PostMessageHandler)};this.Unload=function(){d.ClearTimeouts();var e=Date.now();var f=d.pageModel.learningTime()||0;f+=e-d.startTimestamp;d.pageModel.learningTime(f);d.PostMessage(d.framewindow,"keyboardUnbindf5");delete d.framewindow;delete d.$frame;d._completedSubscription&&d._completedSubscription.dispose();d.$iframe=null;d.player=null;d.pageModel=null;d.onPageInitialized=null};this.Exit=function(){d.ClearTimeouts();d.player.Exit()};this.InitTimeouts=function(){if(!d.loadingTimeoutDuration){return}this._timeoutBeforePageInit=setTimeout(function(){d.ClearTimeouts();d.player.trigger(d.player._events.pageInitTimedOut,{item:d.pageModel});d.player.ShowErrorMessage({text:"The page did not initialize within "+d.loadingTimeoutDuration+"s.",code:d.pageModel.id,resolution:"Ensure the page calls API method 'onBeforeInit()' or check page performance."})},d.loadingTimeoutDuration*1000);this._timeoutPageLoaded=setTimeout(function(){d.ClearTimeouts();d.player.trigger(d.player._events.pageLoadedTimedOut,{item:d.pageModel});d.player.ShowErrorMessage({text:"The page did not load within "+d.loadingTimeoutDuration+"s.",code:d.pageModel.id,resolution:"Ensure the page calls API method 'pageLoaded()' or check page performance."})},d.loadingTimeoutDuration*1000+1)};this.ClearTimeouts=function(){clearTimeout(d._timeoutBeforePageInit);clearTimeout(d._timeoutPageLoaded);clearTimeout(d._autoPlayTimeout)};this._events={pause:"pagecontrollerapi.pause",play:"pagecontrollerapi.play"};this.on=function(f,e){$(d).on(f,e)};this.off=function(f,e){$(d).off(f,e)};this.trigger=function(f,e){if(f){$(d).triggerHandler(f,e)}};this.InitPageControllerAPI=function(){this.InitMessageHandlers()};this.PostMessage=function(g,e,f){if(g&&g.postMessage){g.postMessage({command:e,data:f,pcbid:d.pcbid},"*")}};this.PostMessageHandler=function(f){var e=f.data.command;var g=f.data.pcbid;if(!d.pcbid&&f.data.pcbid){d.pcbid=f.data.pcbid}if(g!==d.pcbid){return}var h={handled:false};d.PostMessageHandlerActions(f,h);if(!h.handled){console.log("PageControllerBase: Unknown message received from common: "+e)}};this.PostMessageHandlerActions=function(g,i){var e=g.data.command;var f,j;var h=true;switch(e){case"exit":d.Exit();break;case"getCBTData":j=ko.toJS(d.player.GetCBTData());for(key in j){if(j.hasOwnProperty(key)){if(typeof j[key]==="function"){delete j[key]}}}f=ko.toJSON(j);d.PostMessage(g.source,"getCBTData",f);break;case"getConfig":d.PostMessage(g.source,"config",ko.toJSON(d.player.config));break;case"getIsDeveloperMode":f=d.player.config.developerMode();d.PostMessage(g.source,"isDeveloperMode",f);break;case"getOrganizationData":j=ko.toJS(d.player.currentOrg());delete j._completion;ds.utils.RemoveObjectFunctions(j);for(key in j.itemsDict){if(j.itemsDict.hasOwnProperty(key)){}}f=ko.toJSON(j);d.PostMessage(g.source,"getOrganizationData",f);break;case"getPageData":f=ko.toJSON(d.pageModel);d.PostMessage(g.source,"getPageData",f);break;case"getVersion":d.PostMessage(g.source,"version",d.player.GetVersion());break;case"keyboardf5":d.player._f5=g.data.data;break;case"loadPageById":d.player.LoadPageById(g.data.data);break;case"mouseMove":d.player.ActivityHandler();break;case"onBeforeInit":d.OnBeforePageInit();break;case"pageLoaded":d.OnPageLoaded();break;case"setPageCompletion":d.SetPageCompletion(g.data.data);break;case"showErrorMessage":d.player.ShowErrorMessage(g.data.data);break;case"showToast":d.player.ShowToast(g.data.data);break;case"showVideo":d.ShowVideo(g.data.data);break;case"setContentContainerBackgroundColor":a=d.player.config.contentContainerBackgroundColor();d.player.config.contentContainerBackgroundColor(g.data.data);break;case"showGlossary":d.player.ShowGlossary();d.player.glossarySearchValue(g.data.data);break;default:h=false;break}if(!i.handled){i.handled=h}};this.InitMessageHandlers=function(){window.addEventListener("message",this.PostMessageHandler,false)};this.EnableDevMode=function(e){e=e===true?true:false;this._isDeveloperMode(e)};TestClearLocalStorage=function(){if(this.player.lmsAPIController.type==="local"){this.player.lmsAPIController.ClearLocalStorage()}};TestClearAllLocalStorage=function(){if(this.player.lmsAPIController.type==="local"){this.player.lmsAPIController.ClearAllLocalStorage()}}};function HTMLPageController(a){var b=this;PageControllerBase.call(this,a);this._className="HTMLPageController";this.type="html";this.$devToolbar=null;this.Resize=function(){var c=$("#contentContainer");var f=c.width();var e=b.player.GetContentHeight();if(b.$frame&&b.$frame.contents()){var d=b.$frame.contents().find("#cbtcontainer");d.width(f);d.height(e)}};this.Reload=function(){if(b.player.currentPage()){b.player.LoadPage(b.player.currentPage())}};this.OnBeforePageInit=ds.utils.ExtendMethod(this.OnBeforePageInit,function(){b.Resize()});this.OnPageLoaded=ds.utils.ExtendMethod(this.OnPageLoaded,function(){b.onPageInitialized(b)});this.Unload=ds.utils.ExtendMethod(this.Unload,function(){if(b.$devToolbar){ko.cleanNode(b.$devToolbar.get(0));b.$devToolbar.remove()}});this.EnableDevMode=ds.utils.ExtendMethod(this.EnableDevMode,function(){var c=b.$frame.contents().find("#canvas");if(this._isDeveloperMode()){b.$devToolbar=$('<div><div class="devToolbar small">\r\n    <div class="inner">\r\n        <div class="container-fluid form-inline">\r\n            <span class="btn-group">\r\n                <span class="btn btn-sm btn-default" data-bind="click: player._DevToggleFastAdvance">Fast Adv. <span class="glyphicon" data-bind="css: { \'glyphicon-check\': player.config.fastAdvance, \'glyphicon-unchecked\': !player.config.fastAdvance() }"></span></span>\r\n                <span class="btn btn-sm btn-default" data-bind="text: player.config._playSpeed() + \'X\', click: player._DevTogglePlaySpeed"></span>\r\n                <span class="btn btn-sm btn-default" data-bind="click: player._DevToggleAutoPlay">Autoplay <span class="glyphicon" data-bind="css: { \'glyphicon-check\': player.config._autoPlay, \'glyphicon-unchecked\': !player.config._autoPlay() }"></span></span>\r\n            </span>\r\n            <div class="dropdown" style="display: inline-block;">\r\n                <span class="btn btn-sm btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">\r\n                    More <span class="caret"></span>\r\n                </span>\r\n                <ul class="dropdown-menu" aria-labelledby="dropdownMenu1">\r\n                    <li><a href="#" data-bind="click: player.ShowDeveloperReport"><span class="glyphicon glyphicon-file"></span> Developer Report</a></li>\r\n                    <!-- ko if: player.lmsAPIController.type === \'local\' -->\r\n                    <li role="separator" class="divider"></li>\r\n                    <li class="dropdown-header">Local Storage</li>\r\n                    <li><a href="#" data-bind="click: TestClearLocalStorage"><span class="glyphicon glyphicon-trash"></span> Clear data for this CBT</a></li>\r\n                    <li><a href="#" data-bind="click: TestClearAllLocalStorage"><span class="glyphicon glyphicon-trash"></span> Clear all data</a></li>\r\n                    <!-- /ko -->\r\n                    <li role="separator" class="divider"></li>\r\n                    <li><a href="#" data-bind="click: player.ShowDeveloperHelp"><span class="glyphicon glyphicon-question-sign"></span> Help</a></li>\r\n                </ul>\r\n            </div>\r\n            <!--<span>idle: <span data-bind="text: player.currentIdleSeconds"></span></span>-->\r\n        </div>\r\n    </div>\r\n</div></div>');ko.applyBindings(b,b.$devToolbar.get(0));$("#devToolbar").append(b.$devToolbar)}else{if(b.$devToolbar){ko.cleanNode(b.$devToolbar.get(0));b.$devToolbar.remove()}}});this.InitPageControllerAPI();this.InitTimeouts()}CBTPlayer.RegisterPageController("html",HTMLPageController);function HTMLHomePageController(a){var b=this;HTMLPageController.call(this,a);this._className="HTMLHomePageController";this.type="htmlhome";this.OnPageLoaded=ds.utils.ExtendMethod(this.OnPageLoaded,function(){b.player.isPlaybackToolbarVisible(false)})}CBTPlayer.RegisterPageController("htmlhome",HTMLHomePageController);function CanvasPageController(options){var that=this;PageControllerBase.call(this,options);this._className="CanvasPageController";this.type="canvas";this.$devToolbar=null;this.Resize=function(){var $container=$("#contentContainer");var frameWidth=$container.width();var frameHeight=that.player.GetContentHeight();that.PostMessage(that.framewindow,"canvasResize",{frameWidth:frameWidth,frameHeight:frameHeight})};this.canPlay=ko.pureComputed(function(){if(this.currentSection()){if(this.currentSection()._avCompleted()){return false}}return true},this).extend({rateLimit:{timeout:200,method:"notifyWhenChangesStop"}});this.Play=ds.utils.ExtendMethod(this.Play,function(){that.ResumeAudio();that.PostMessage(that.framewindow,"canvasPlay")});this.canPause=ko.pureComputed(function(){var section=this.currentSection();if(section){if(this.currentSection()._avCompleted()){return false}}return true},this).extend({rateLimit:{timeout:200,method:"notifyWhenChangesStop"}});this.Pause=ds.utils.ExtendMethod(this.Pause,function(){this.PauseAudio();this.PostMessage(this.framewindow,"canvasStop")});this.Reload=function(){this.ResetSectionAVCompletion(this.currentSection());this.LoadSection(this.pageModel.sections[0])};this.Stop=function(){this.PostMessage(that.framewindow,"canvasStop")};this.soundsPlaying={};this.audioManifest=null;this.devSelectedAudio=ko.observable();this.PauseAudio=function(){for(var key in that.soundsPlaying){if(that.soundsPlaying.hasOwnProperty(key)){that.soundsPlaying[key].pause()}}};this.ResumeAudio=function(){for(var key in that.soundsPlaying){if(that.soundsPlaying.hasOwnProperty(key)){that.soundsPlaying[key].resume()}}};this.PreloadAudio=function(pageModel){var queue;var master=new $.Deferred();var reloadNumber=3;function load(audioManifest){createjs.Sound.removeAllSounds();queue=new createjs.LoadQueue();createjs.Sound.alternateExtensions=["mp3"];queue.installPlugin(createjs.Sound);queue.addEventListener("complete",function(event){master.resolve(true)});queue.addEventListener("fileload",function(evt){});queue.addEventListener("error",function(event){queue.removeAllEventListeners();reloadNumber--;if(reloadNumber!==undefined&&reloadNumber!==0){load(audioManifest)}else{that.player.ShowErrorMessage({code:PlayerConstants.ErrorCodes.LOAD_AUDIO})}master.reject(event)});queue.addEventListener("progress",function(event){});queue.loadManifest(audioManifest)}that.audioManifest=that.CreateAudioManifest(pageModel);if(that.audioManifest.length>0){load(that.audioManifest)}else{master.resolve(false)}return master.promise()};this.CreateAudioManifest=function(pageModel){var manifest=[];ko.utils.arrayForEach(pageModel.sections,function(section){if(section.audioLocation){manifest.push({id:section.id,src:that.pageModel.folderPath+section.audioLocation})}});if(pageModel.data&&pageModel.data.audio){ko.utils.arrayForEach(pageModel.data.audio,function(obj){var o=$.extend({},obj);o.src=pageModel.folderPath+obj.src;manifest.push(o)})}return manifest};this.StopAudio=function(){createjs.Sound.stop()};this.CompleteSectionAudio=function(){that.currentSection()._audioCompleted(true);if(!that.currentSection()._avCompleted()){that.ProcessSectionCompletion(that.currentSection());that.ProcessPageCompletion(that.pageModel)}};this.PlaySectionAudio=function(section){if(section){this.PlayAudioById(section.id,{onComplete:function(){that.CompleteSectionAudio()}})}};this.StopAudioById=function(id){var sound=that.soundsPlaying[id];if(sound){sound.stop()}};this.PlayAudioById=function(id,options){var opts={onComplete:function(){},loop:0};$.extend(true,opts,options);var completeHandler=opts.onComplete.toString().replace("parent.pageControllerAPI.p","that.P");opts.onComplete=eval("("+completeHandler+")");var sound=createjs.Sound.play(id,{loop:opts.loop});var speed=that.player.config._playSpeed();if(speed!==1){setTimeout(function(){sound.sourceNode&&(sound.sourceNode.playbackRate.value=speed)},200);setTimeout(function(){sound.sourceNode&&(sound.sourceNode.playbackRate.value=speed)},1000);sound.sourceNode&&(sound.sourceNode.onended=that.CompleteSectionAudio);if((that.player.isMobile()||createjs.Sound.BrowserDetect.isChrome)&&sound.sourceNode&&sound.sourceNode.buffer&&sound.sourceNode.buffer.duration){var d=sound.sourceNode.buffer.duration;setTimeout(function(){that.CompleteSectionAudio()},d/speed*1000)}setTimeout(function(){sound.tag&&(sound.tag.playbackRate=speed)},200);setTimeout(function(){sound.tag&&(sound.tag.playbackRate=speed)},1000)}var handler=function(event){sound.removeEventListener("complete",handler);opts.onComplete(event)};sound.addEventListener("complete",handler);that.soundsPlaying[id]=sound;return sound};this.audioText=ko.pureComputed(function(){return this.currentSection()&&this.currentSection().audioText},this);this.transcriptText=ko.pureComputed(function(){var s="";var sections=this.pageModel.sections;ko.utils.arrayForEach(sections,function(section){s+="<p>"+section.audioText+"</p>"});return s},this);this._sectionsEnabled=ko.observable(true);this.currentSection=ko.observable();this.PlaySectionById=function(id){var section=that.pageModel.sectionsDict()[id];if(section){that.LoadSection(section)}else{that.player.Alert("Unable to play section "+id)}};this.LoadSection=function(section,autoPlay){autoPlay=autoPlay===false?false:true;if(section){this.StopAudio();this.ResetSectionAVCompletion(section);this.currentSection(section);this.PostMessage(this.framewindow,"canvasGotoAndPlay",section.id);this.PlaySectionAudio(section);if(!autoPlay){that.Pause()}}};this.CompleteSectionVision=function(){that.currentSection()._visualCompleted(true);that.ProcessSectionCompletion(that.currentSection());that.ProcessPageCompletion(that.pageModel)};this.ProcessSectionCompletion=function(section){var avCompleted=false;var completion=section.completion;var advance=section.advance;section._played(true);switch(completion){case PlayerConstants.SectionCompletionTypes.AUDIO:if(section._audioCompleted()){avCompleted=true}break;case PlayerConstants.SectionCompletionTypes.VISION:if(section._visualCompleted()){avCompleted=true}break;case PlayerConstants.SectionCompletionTypes.BOTH:if(section._audioCompleted()&&section._visualCompleted()){avCompleted=true}break;default:avCompleted=true}section._avCompleted(avCompleted);if(avCompleted&&advance!==PlayerConstants.SectionAdvanceTypes.WAIT){if(section.instruction){that.player.ShowToast({text:section.instruction})}this.LoadNextSection()}};this.ResetSectionAVCompletion=function(section){section._avCompleted(false);section._audioCompleted(false);section._visualCompleted(false)};this.DisableSectionSkip=function(){that._sectionsEnabled(false)};this.EnableSectionSkip=function(){that._sectionsEnabled(true)};this.canPlayNextSection=ko.pureComputed(function(){var fastAdvance=that.player.config.fastAdvance();if(!that._sectionsEnabled()){return false}var sections=that.pageModel.sections;var section=that.currentSection();if(section){var index=sections.indexOf(section);if(index===sections.length-1){return false}if(fastAdvance){return true}if(that.pageModel.completed()){return true}if(!section._played()){return false}return true}else{return false}},this).extend({rateLimit:{timeout:200,method:"notifyWhenChangesStop",notify:"always"}});this.LoadNextSection=function(){var sections=that.pageModel.sections;var section=that.currentSection();var advance=section.advance;var index=sections.indexOf(section);switch(advance){case PlayerConstants.SectionAdvanceTypes.AUTO:if(index!==sections.length-1){that.LoadSection(sections[index+1])}break;case PlayerConstants.SectionAdvanceTypes.WAIT:break}};this.canPlayPreviousSection=ko.pureComputed(function(){if(!that._sectionsEnabled()){return false}var sections=that.pageModel.sections;var section=that.currentSection();if(section){var advance=section.advance;var index=sections.indexOf(section);if(index===0){return false}return true}else{return false}},this);this.LoadPreviousSection=function(){var sections=that.pageModel.sections;var section=that.currentSection();var advance=section.advance;var index=sections.indexOf(section);if(index!==0){that.LoadSection(sections[index-1])}};this.ShowProtection=function(flag){flag=flag===true?true:false;this.PostMessage(this.framewindow,"canvasShowProtection",flag)};this.SetQuality=function(val){this.PostMessage(this.framewindow,"canvasQuality",{val:val,isMobile:this.player.isMobile()})};this.ProcessPageCompletion=function(page){var completed=false;switch(page.completion){case PlayerConstants.PageCompletionTypes.ALL_SECTION:completed=true;$.each(page.sections,function(section){if(!section._avCompleted()){completed=false;return}});break;case PlayerConstants.PageCompletionTypes.LAST_SECTION:default:var section=page.sections[page.sections.length-1];if(section&&section._avCompleted()&&!that.canPlayNextSection()){completed=true}break}if(page.completion){switch(page.completion.substr(0,5)){case PlayerConstants.PageCompletionTypes.TIMER_NUMBER:setTimeout(function(){completed=true},getTimerNumber(completion));break;case PlayerConstants.PageCompletionTypes.DIFFERENT_SECTION:checkSectionlogic(completion);break}}if(completed){that.SetPageCompletion(completed)}};this.Start=function(model){that.PostMessage(that.framewindow,"canvasStyle");that.PostMessage(that.framewindow,"canvasStart")};this._playTimeout=null;this.OnBeforePageInit=ds.utils.ExtendMethod(this.OnBeforePageInit,function(){that.PostMessage(that.framewindow,"canvasSpeed",that.player.config._playSpeed())});this._OnBeforePageLoaded=function(){that.Start(that.pageModel);that.Stop();that.ShowProtection(false);$.when(that.PreloadAudio(that.pageModel)).done(function(audioLoaded){that.OnPageLoaded()})};this.OnPageLoaded=ds.utils.ExtendMethod(this.OnPageLoaded,function(){var section=that.pageModel.sections[0];that.LoadSection(section,false);that.onPageInitialized(that);var $container=$("#contentContainer");var frameWidth=$container.width();var frameHeight=that.player.GetContentHeight();that.PostMessage(that.framewindow,"initCanvasLayout",{frameWidth:frameWidth,frameHeight:frameHeight,val:that.player.config._canvasGraphicsQuality(),isMobile:that.player.isMobile()})});this.OnCanvasLayoutInitialized=function(){that._playTimeout=setTimeout(function(){that.player.isLoadingPage(false);that.Play()},500)};this.OnBeforeUnload=ds.utils.ExtendMethod(this.OnBeforeUnload,function(){that.PostMessage(that.framewindow,"canvasOnBeforeUnload");that.PostMessage(that.framewindow,"canvasUnload");clearTimeout(that._playTimeout);if(that.$devToolbar){ko.cleanNode(that.$devToolbar.get(0));that.$devToolbar.remove()}});this.Unload=ds.utils.ExtendMethod(this.Unload,function(){});this.PostMessageHandlerActions=ds.utils.ExtendMethod(this.PostMessageHandlerActions,function(ev,result){var command=ev.data.command;var d,tempObj;var handled=true;switch(command){case"completeVision":that.CompleteSectionVision();break;case"disableSectionSkip":this.DisableSectionSkip();break;case"enableSectionSkip":this.EnableSectionSkip();break;case"_OnBeforePageLoaded":that._OnBeforePageLoaded();break;case"pauseAudio":this.PauseAudio();break;case"playAudioById":this.PlayAudioById(ev.data.data.id,ev.data.data.options);break;case"playExternalAudio":this.PlayAudioById(ev.data.data.id,ev.data.data.options);break;case"playSectionById":this.PlaySectionById(ev.data.data);break;case"resumeAudio":this.ResumeAudio();break;case"setPrivateData":break;case"stopAudioById":this.StopAudioById(ev.data.data);break;case"templateReady":break;case"canvasLayoutInitialized":that.OnCanvasLayoutInitialized();break;default:handled=false;break}if(!result.handled){result.handled=handled}});this.EnableDevMode=ds.utils.ExtendMethod(this.EnableDevMode,function(){var $canvas=that.$frame.contents().find("#canvas");if(this._isDeveloperMode()){$canvas.css({border:"1px solid cyan"});that.$devToolbar=$('<div><div class="devToolbar small">\r\n    <div class="inner">\r\n        <div class="container-fluid form-inline">\r\n            <!-- ko if: currentSection() -->\r\n            <div class="input-group input-group-sm">\r\n                <span class="input-group-addon">\r\n                    <strong>Section:</strong>\r\n                    <span data-bind="text: currentSection().id"></span>\r\n                    <span>\r\n                        (<span data-bind="text: pageModel.sections.indexOf(currentSection()) + 1"></span>/<span data-bind="text: pageModel.sections.length"></span>)\r\n                    </span>\r\n                </span>\r\n                <div class="input-group-btn">\r\n                    <span class="btn btn-sm btn-default" data-bind="click: LoadPreviousSection"><span class="glyphicon glyphicon-chevron-left"></span></span>\r\n                    <span class="btn btn-sm btn-default" data-bind="click: LoadNextSection"><span class="glyphicon glyphicon-chevron-right"></span></span>\r\n                </div>\r\n            </div>\r\n            <div class="input-group input-group-sm">\r\n                <!-- ko if: currentSection().audioLocation -->\r\n                <span class="input-group-addon">\r\n                    <strong>Audio:</strong>\r\n                    <span data-bind="text: currentSection().audioLocation"></span>\r\n                </span>\r\n                <!-- /ko -->\r\n                <span class="input-group-addon" style="padding: 0;">\r\n\r\n                    <select class="form-control input-sm" style="display: inline-block;" data-bind="options: audioManifest, optionsText: \'id\', value: devSelectedAudio, optionsCaption: \'Audio...\'"></select>\r\n                </span>\r\n                <div class="input-group-btn">\r\n                    <span class="btn btn-sm btn-default" data-bind="click: TestPlayAudio"><span class="glyphicon glyphicon-play"></span></span>\r\n                    <span class="btn btn-sm btn-default" data-bind="click: TestStopAudio"><span class="glyphicon glyphicon-stop"></span></span>\r\n                </div>\r\n            </div>\r\n\r\n            <!-- /ko -->\r\n            <span class="btn-group">\r\n                <span class="btn btn-sm btn-default" data-bind="click: player._DevToggleFastAdvance">Fast Adv. <span class="glyphicon" data-bind="css: { \'glyphicon-check\': player.config.fastAdvance, \'glyphicon-unchecked\': !player.config.fastAdvance() }"></span></span>\r\n                <span class="btn btn-sm btn-default" data-bind="text: player.config._playSpeed() + \'X\', click: player._DevTogglePlaySpeed"></span>\r\n                <span class="btn btn-sm btn-default" data-bind="click: player._DevToggleAutoPlay">Autoplay <span class="glyphicon" data-bind="css: { \'glyphicon-check\': player.config._autoPlay, \'glyphicon-unchecked\': !player.config._autoPlay() }"></span></span>\r\n                <span class="btn btn-sm btn-default" data-bind="text: \'Graphics Mode: \' + player.config._canvasGraphicsQuality(), click: function () { player._DevToggleGraphicsQuality(); SetQuality(player.config._canvasGraphicsQuality()); }"></span>\r\n            </span>\r\n            <div class="dropdown" style="display: inline-block;">\r\n                <span class="btn btn-sm btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">\r\n                    More <span class="caret"></span>\r\n                </span>\r\n                <ul class="dropdown-menu" aria-labelledby="dropdownMenu1">\r\n                    <li><a href="#" data-bind="click: player.ShowDeveloperReport"><span class="glyphicon glyphicon-file"></span> Developer Report</a></li>\r\n                    <!-- ko if: player.lmsAPIController.type === \'local\' -->\r\n                    <li role="separator" class="divider"></li>\r\n                    <li class="dropdown-header">Local Storage</li>\r\n                    <li><a href="#" data-bind="click: TestClearLocalStorage"><span class="glyphicon glyphicon-trash"></span> Clear data for this CBT</a></li>\r\n                    <li><a href="#" data-bind="click: TestClearAllLocalStorage"><span class="glyphicon glyphicon-trash"></span> Clear all data</a></li>\r\n                    <!-- /ko -->\r\n                    <li role="separator" class="divider"></li>\r\n                    <li><a href="#" data-bind="click: player.ShowDeveloperHelp"><span class="glyphicon glyphicon-question-sign"></span> Help</a></li>\r\n                </ul>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div></div>');ko.applyBindings(that,that.$devToolbar.get(0));$("#devToolbar").append(that.$devToolbar)}else{$canvas.css({border:"none"});if(that.$devToolbar){ko.cleanNode(that.$devToolbar.get(0));that.$devToolbar.remove()}}});this.TestPlayAudio=function(){if(that.devSelectedAudio()){that.PlayAudioById(that.devSelectedAudio().id)}};this.TestStopAudio=function(){if(that.devSelectedAudio()){that.StopAudioById(that.devSelectedAudio().id)}};this.InitPageControllerAPI();this.InitTimeouts()}CBTPlayer.RegisterPageController("canvas",CanvasPageController);function AnimateCC2017_5Controller(a){var b=this;PageControllerBase.call(this,a);this._className="AnimateCC2017_5Controller";this.type="animatecc2017_5";this.createjs=null;this.$devToolbar=null;this.Resize=function(){var e=$("#contentContainer");var k=e.width();var i=b.player.audioTextEnabled()&&b.audioText()?e.height()-100:e.height();var j=k/i;var c=b.$frame.contents().find("#canvas");var d=b.$frame.contents().find("#canvasOuterContainer");var h=c.width();var f=c.height();var g=h/f;var l=j>g?i/f:k/h;if(l){c.width(l*h);c.height(l*f);var m=(i-l*f)/2;if(m<=0){m=0}d.css({"padding-top":m+"px","-webkit-box-sizing":"border-box","-moz-box-sizing":"border-box","box-sizing":"border-box"})}};this.canPlay=ko.pureComputed(function(){if(this.currentSection()){if(this.currentSection().completed()){return false}}return true},this).extend({rateLimit:{timeout:200,method:"notifyWhenChangesStop"}});this.Play=function(){for(var c in this.soundsPlaying){if(this.soundsPlaying.hasOwnProperty(c)){this.soundsPlaying[c].resume()}}this.framewindow.exportRoot&&this.framewindow.exportRoot.play()};this.canPause=ko.pureComputed(function(){if(this.currentSection()){if(this.currentSection().completed()){return false}}return true},this).extend({rateLimit:{timeout:200,method:"notifyWhenChangesStop"}});this.Pause=function(){this.PauseAudio();this.framewindow.exportRoot&&this.framewindow.exportRoot.stop()};this.Reload=function(){this.ResetSectionAVCompletion(this.currentSection());this.LoadSection(this.pageModel.sections[0])};this.Stop=function(){this.framewindow.exportRoot&&this.framewindow.exportRoot.stop()};this.soundsPlaying={};this.audioManifest=null;this.devSelectedAudio=ko.observable();this.PauseAudio=function(){for(var c in this.soundsPlaying){if(this.soundsPlaying.hasOwnProperty(c)){this.soundsPlaying[c].pause()}}};this.PreloadAudio=function(e){var f;var d=new $.Deferred();var g=3;function c(h){createjs.Sound.removeAllSounds();f=new createjs.LoadQueue();createjs.Sound.alternateExtensions=["mp3"];f.installPlugin(createjs.Sound);f.addEventListener("complete",function(i){d.resolve(true)});f.addEventListener("fileload",function(i){});f.addEventListener("error",function(i){f.removeAllEventListeners();g--;if(g!==undefined&&g!==0){c(h)}else{b.player.ShowErrorMessage({code:PlayerConstants.ErrorCodes.LOAD_AUDIO})}d.reject(i)});f.addEventListener("progress",function(i){});f.loadManifest(h)}b.audioManifest=b.CreateAudioManifest(e);if(b.audioManifest.length>0){c(b.audioManifest)}else{d.resolve(false)}return d.promise()};this.CreateAudioManifest=function(d){var c=[];ko.utils.arrayForEach(d.sections,function(e){if(e.audioLocation){c.push({id:e.id,src:b.pageModel.folderPath+e.audioLocation})}});if(d.data&&d.data.audio){ko.utils.arrayForEach(d.data.audio,function(f){var e=$.extend({},f);e.src=d.folderPath+f.src;c.push(e)})}return c};this.StopAudio=function(){createjs.Sound.stop()};this.CompleteSectionAudio=function(){if(!b.currentSection()._audioCompleted()&&!b.currentSection().completed()){b.currentSection()._audioCompleted(true);b.ProcessSectionCompletion(b.currentSection());b.ProcessPageCompletion(b.pageModel)}};this.PlaySectionAudio=function(c){if(c){this.PlayAudioById(c.id,{onComplete:function(){b.CompleteSectionAudio()}})}};this.StopAudioById=function(c){var d=this.soundsPlaying[c];if(d){d.stop()}};this.PlayAudioById=function(f,g){var h={onComplete:function(){},loop:0};$.extend(true,h,g);var i=createjs.Sound.play(f,{loop:h.loop});var j=b.player.config._playSpeed();if(j!==1){setTimeout(function(){i.sourceNode&&(i.sourceNode.playbackRate.value=j)},200);setTimeout(function(){i.sourceNode&&(i.sourceNode.playbackRate.value=j)},1000);i.sourceNode&&(i.sourceNode.onended=b.CompleteSectionAudio);if((b.player.isMobile()||createjs.Sound.BrowserDetect.isChrome)&&i.sourceNode&&i.sourceNode.buffer&&i.sourceNode.buffer.duration){var c=i.sourceNode.buffer.duration;setTimeout(function(){b.CompleteSectionAudio()},c/j*1000)}setTimeout(function(){i.tag&&(i.tag.playbackRate=j)},200);setTimeout(function(){i.tag&&(i.tag.playbackRate=j)},1000)}var e=function(d){i.removeEventListener("complete",e);h.onComplete(d)};i.addEventListener("complete",e);b.soundsPlaying[f]=i;return i};this.audioText=ko.pureComputed(function(){return this.currentSection()&&this.currentSection().audioText},this);this.transcriptText=ko.pureComputed(function(){var c="";var d=this.pageModel.sections;ko.utils.arrayForEach(d,function(e){c+="<p>"+e.audioText+"</p>"});return c},this);this._sectionsEnabled=ko.observable(true);this.currentSection=ko.observable();this.PlaySectionById=function(c){var d=b.pageModel.sectionsDict()[c];if(d){b.LoadSection(d)}else{b.player.Alert("Unable to play section "+c)}};this.LoadSection=function(d,c){c=c===false?false:true;if(d){this.StopAudio();this.ResetSectionAVCompletion(d);this.currentSection(d);this.framewindow.exportRoot&&this.framewindow.exportRoot.gotoAndPlay(d.id);this.PlaySectionAudio(d);if(!c){b.Pause()}this.ShowProtection(false)}};this.CompleteSectionVision=function(){b.currentSection()._visualCompleted(true);b.ProcessSectionCompletion(b.currentSection());b.ProcessPageCompletion(b.pageModel)};this.ProcessSectionCompletion=function(f){var d=false;var e=f.completion;var c=f.advance;f._played(true);switch(e){case PlayerConstants.SectionCompletionTypes.AUDIO:if(f._audioCompleted()){d=true}break;case PlayerConstants.SectionCompletionTypes.VISION:if(f._visualCompleted()){d=true}break;case PlayerConstants.SectionCompletionTypes.BOTH:if(f._audioCompleted()&&f._visualCompleted()){d=true}break;default:d=true}f.completed(d);if(d&&c!==PlayerConstants.SectionAdvanceTypes.WAIT){if(f.instruction){b.player.ShowToast({text:f.instruction})}this.LoadNextSection()}};this.ResetSectionAVCompletion=function(c){c._avCompleted(false);c._audioCompleted(false);c._visualCompleted(false)};this.DisableSectionSkip=function(){b._sectionsEnabled(false)};this.EnableSectionSkip=function(){b._sectionsEnabled(true)};this.canPlayNextSection=ko.pureComputed(function(){if(!b._sectionsEnabled()){return false}var f=b.pageModel.sections;var e=b.currentSection();if(e){var c=e.advance;var d=f.indexOf(e);if(d===f.length-1){return false}return true}else{return false}},this);this.LoadNextSection=function(){var f=b.pageModel.sections;var e=b.currentSection();var c=e.advance;var d=f.indexOf(e);switch(c){case PlayerConstants.SectionAdvanceTypes.AUTO:if(d!==f.length-1){b.LoadSection(f[d+1])}break;case PlayerConstants.SectionAdvanceTypes.WAIT:break}};this.canPlayPreviousSection=ko.pureComputed(function(){if(!b._sectionsEnabled()){return false}var f=b.pageModel.sections;var e=b.currentSection();if(e){var c=e.advance;var d=f.indexOf(e);if(d===0){return false}return true}else{return false}},this);this.LoadPreviousSection=function(){var f=b.pageModel.sections;var e=b.currentSection();var c=e.advance;var d=f.indexOf(e);if(d!==0){b.LoadSection(f[d-1])}};this.ShowProtection=function(c){c=c===true?true:false;var d=this.framewindow.exportRoot&&this.framewindow.exportRoot.prot;d&&(d.visible=c)};this.SetQuality=function(e){var c=b.$frame.contents().find("#canvas");var d=this.framewindow.stage||{};if(e==="auto"){if(b.player.isMobile()){e="med"}else{e="hi"}}switch(e){case"low":c.attr("width","640");c.attr("height","352");d.scaleX&&(d.scaleX=0.64);d.scaleY&&(d.scaleY=0.64);break;case"med":c.attr("width","1000");c.attr("height","550");d.scaleX&&(d.scaleX=1);d.scaleY&&(d.scaleY=1);break;case"hi":c.attr("width","1920");c.attr("height","1056");d.scaleX&&(d.scaleX=1.92);d.scaleY&&(d.scaleY=1.92);break}};this.ProcessPageCompletion=function(d){var c=false;switch(d.completion){case PlayerConstants.PageCompletionTypes.ALL_SECTION:c=true;$.each(d.sections,function(f){if(!f.completed()){c=false;return}});break;case PlayerConstants.PageCompletionTypes.LAST_SECTION:default:var e=d.sections[d.sections.length-1];if(e&&e.completed()){c=true}break}if(d.completion){switch(d.completion.substr(0,5)){case PlayerConstants.PageCompletionTypes.TIMER_NUMBER:setTimeout(function(){c=true},getTimerNumber(completion));break;case PlayerConstants.PageCompletionTypes.DIFFERENT_SECTION:checkSectionlogic(completion);break}}if(c){b.SetPageCompletion(c)}};this.Start=function(e){var f={};var c=b.$frame.contents().find("body, html");var d=b.$frame.contents().find("#canvas");c.css({textAlign:"center",margin:"0",padding:"0","background-color":"transparent"});d.css({"background-color":"transparent","-webkit-tap-highlight-color":"transparent",display:"block","margin-left":"auto","margin-right":"auto",padding:"0"}).wrap('<div id="canvasOuterContainer" style="height: 100vh;"></div>');b.SetQuality(b.player.config._canvasGraphicsQuality());b.ImproveBitmapCache();if(b._isDeveloperMode()){b.InitFrameKeyboard()}};this.ImproveBitmapCache=function(){var e=b.framewindow.exportRoot;for(var c in e){if(e.hasOwnProperty(c)){if(c.indexOf("_pelecache")>=0){var d=e[c];if(d._cacheWidth||d._cacheHeight){d.cache(d._cacheOffsetX,d._cacheOffsetY,d._cacheWidth,d._cacheHeight,2)}else{d._cacheScale=2}}}}};this._playTimeout=null;this.OnBeforePageInit=ds.utils.ExtendMethod(this.OnBeforePageInit,function(){b.createjs=b.framewindow.createjs});this.OnPageInitialized=function(){var c=b.player.config._playSpeed();if(c!==1){b.framewindow.lib.properties.fps*=c}b.Start(b.pageModel);b.Stop();b.ShowProtection(false);$.when(b.PreloadAudio(b.pageModel)).done(function(d){b.OnPageLoaded()})};this.OnPageLoaded=ds.utils.ExtendMethod(this.OnPageLoaded,function(){var c=b.pageModel.sections[0];b.LoadSection(c,false);b.onPageInitialized(b);b._playTimeout=setTimeout(function(){b.Play()},500)});this.OnBeforeUnload=ds.utils.ExtendMethod(this.OnBeforeUnload,function(){b.createjs&&b.createjs.Ticker&&b.createjs.Ticker.removeAllEventListeners()});this.Unload=ds.utils.ExtendMethod(this.Unload,function(){b.createjs.Ticker.removeAllEventListeners();delete b.createjs;clearTimeout(b._playTimeout);if(b.$devToolbar){ko.cleanNode(b.$devToolbar.get(0));b.$devToolbar.remove()}});this.InitPageControllerAPI=ds.utils.ExtendMethod(this.InitPageControllerAPI,function(c){$.extend(true,window.pageControllerAPI,{completeVision:this.CompleteSectionVision,enableSectionSkip:this.EnableSectionSkip,disableSectionSkip:this.DisableSectionSkip,pageInitialized:this.OnPageInitialized,pauseAudio:this.PauseAudio,playAudioById:this.PlayAudioById,playExternalAudio:this.PlayAudioById,playSectionById:this.PlaySectionById,stopAudioById:this.StopAudioById,setPrivateData:function(d){},templateReady:function(){},})});this.EnableDevMode=ds.utils.ExtendMethod(this.EnableDevMode,function(){var c=b.$frame.contents().find("#canvas");if(this._isDeveloperMode()){c.css({border:"1px solid cyan"});b.$devToolbar=$('<div><div class="devToolbar small">\r\n    <div class="inner">\r\n        <div class="container-fluid form-inline">\r\n            <!-- ko if: currentSection() -->\r\n            <div class="input-group input-group-sm">\r\n                <span class="input-group-addon">\r\n                    <strong>Section:</strong>\r\n                    <span data-bind="text: currentSection().id"></span>\r\n                    <span>\r\n                        (<span data-bind="text: pageModel.sections.indexOf(currentSection()) + 1"></span>/<span data-bind="text: pageModel.sections.length"></span>)\r\n                    </span>\r\n                </span>\r\n                <div class="input-group-btn">\r\n                    <span class="btn btn-sm btn-default" data-bind="click: LoadPreviousSection"><span class="glyphicon glyphicon-chevron-left"></span></span>\r\n                    <span class="btn btn-sm btn-default" data-bind="click: LoadNextSection"><span class="glyphicon glyphicon-chevron-right"></span></span>\r\n                </div>\r\n            </div>\r\n            <div class="input-group input-group-sm">\r\n                <!-- ko if: currentSection().audioLocation -->\r\n                <span class="input-group-addon">\r\n                    <strong>Audio:</strong>\r\n                    <span data-bind="text: currentSection().audioLocation"></span>\r\n                </span>\r\n                <!-- /ko -->\r\n                <span class="input-group-addon" style="padding: 0;">\r\n\r\n                    <select class="form-control input-sm" style="display: inline-block;" data-bind="options: audioManifest, optionsText: \'id\', value: devSelectedAudio, optionsCaption: \'Audio...\'"></select>\r\n                </span>\r\n                <div class="input-group-btn">\r\n                    <span class="btn btn-sm btn-default" data-bind="click: TestPlayAudio"><span class="glyphicon glyphicon-play"></span></span>\r\n                    <span class="btn btn-sm btn-default" data-bind="click: TestStopAudio"><span class="glyphicon glyphicon-stop"></span></span>\r\n                </div>\r\n            </div>\r\n\r\n            <!-- /ko -->\r\n            <span class="btn-group">\r\n                <span class="btn btn-sm btn-default" data-bind="click: player._DevToggleFastAdvance">Fast Adv. <span class="glyphicon" data-bind="css: { \'glyphicon-check\': player.config.fastAdvance, \'glyphicon-unchecked\': !player.config.fastAdvance() }"></span></span>\r\n                <span class="btn btn-sm btn-default" data-bind="text: player.config._playSpeed() + \'X\', click: player._DevTogglePlaySpeed"></span>\r\n                <span class="btn btn-sm btn-default" data-bind="click: player._DevToggleAutoPlay">Autoplay <span class="glyphicon" data-bind="css: { \'glyphicon-check\': player.config._autoPlay, \'glyphicon-unchecked\': !player.config._autoPlay() }"></span></span>\r\n                <span class="btn btn-sm btn-default" data-bind="text: \'Graphics Mode: \' + player.config._canvasGraphicsQuality(), click: function () { player._DevToggleGraphicsQuality(); SetQuality(player.config._canvasGraphicsQuality()); }"></span>\r\n            </span>\r\n            <div class="dropdown" style="display: inline-block;">\r\n                <span class="btn btn-sm btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">\r\n                    More <span class="caret"></span>\r\n                </span>\r\n                <ul class="dropdown-menu" aria-labelledby="dropdownMenu1">\r\n                    <li><a href="#" data-bind="click: player.ShowDeveloperReport"><span class="glyphicon glyphicon-file"></span> Developer Report</a></li>\r\n                    <!-- ko if: player.lmsAPIController.type === \'local\' -->\r\n                    <li role="separator" class="divider"></li>\r\n                    <li class="dropdown-header">Local Storage</li>\r\n                    <li><a href="#" data-bind="click: TestClearLocalStorage"><span class="glyphicon glyphicon-trash"></span> Clear data for this CBT</a></li>\r\n                    <li><a href="#" data-bind="click: TestClearAllLocalStorage"><span class="glyphicon glyphicon-trash"></span> Clear all data</a></li>\r\n                    <!-- /ko -->\r\n                    <li role="separator" class="divider"></li>\r\n                    <li><a href="#" data-bind="click: player.ShowDeveloperHelp"><span class="glyphicon glyphicon-question-sign"></span> Help</a></li>\r\n                </ul>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div></div>');ko.applyBindings(b,b.$devToolbar.get(0));$("#devToolbar").append(b.$devToolbar)}else{c.css({border:"none"});if(b.$devToolbar){ko.cleanNode(b.$devToolbar.get(0));b.$devToolbar.remove()}}});this.TestPlayAudio=function(){if(b.devSelectedAudio()){b.PlayAudioById(b.devSelectedAudio().id)}};this.TestStopAudio=function(){if(b.devSelectedAudio()){b.StopAudioById(b.devSelectedAudio().id)}};this.InitPageControllerAPI();this.InitTimeouts()}CBTPlayer.RegisterPageController("animatecc2017_5",AnimateCC2017_5Controller);function SCO2004PageController(a){var b=this;PageControllerBase.call(this,a);this._className="SCO2004PageController";this.type="sco2004";this.$devToolbar=null;this.Resize=function(){var c=$("#contentContainer");var f=c.width();var e=b.player.GetContentHeight();if(b.$frame&&b.$frame.contents()){var d=b.$frame.contents().find("#cbtcontainer");d.width(f);d.height(e)}};this.Reload=function(){if(b.player.currentPage()){b.player.LoadPage(b.player.currentPage())}};this.OnBeforePageInit=ds.utils.ExtendMethod(this.OnBeforePageInit,function(){b.Resize()});this.OnPageLoaded=ds.utils.ExtendMethod(this.OnPageLoaded,function(){b.onPageInitialized(b)});this.Unload=ds.utils.ExtendMethod(this.Unload,function(){if(b.$devToolbar){ko.cleanNode(b.$devToolbar.get(0));b.$devToolbar.remove()}});this.EnableDevMode=ds.utils.ExtendMethod(this.EnableDevMode,function(){var c=b.$frame.contents().find("#canvas");if(this._isDeveloperMode()){b.$devToolbar=$('<div><div class="devToolbar small">\r\n    <div class="inner">\r\n        <div class="container-fluid form-inline">\r\n            <span class="btn-group">\r\n                <span class="btn btn-sm btn-default" data-bind="click: player._DevToggleFastAdvance">Fast Adv. <span class="glyphicon" data-bind="css: { \'glyphicon-check\': player.config.fastAdvance, \'glyphicon-unchecked\': !player.config.fastAdvance() }"></span></span>\r\n                <span class="btn btn-sm btn-default" data-bind="text: player.config._playSpeed() + \'X\', click: player._DevTogglePlaySpeed"></span>\r\n                <span class="btn btn-sm btn-default" data-bind="click: player._DevToggleAutoPlay">Autoplay <span class="glyphicon" data-bind="css: { \'glyphicon-check\': player.config._autoPlay, \'glyphicon-unchecked\': !player.config._autoPlay() }"></span></span>\r\n            </span>\r\n            <div class="dropdown" style="display: inline-block;">\r\n                <span class="btn btn-sm btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">\r\n                    More <span class="caret"></span>\r\n                </span>\r\n                <ul class="dropdown-menu" aria-labelledby="dropdownMenu1">\r\n                    <li><a href="#" data-bind="click: player.ShowDeveloperReport"><span class="glyphicon glyphicon-file"></span> Developer Report</a></li>\r\n                    <!-- ko if: player.lmsAPIController.type === \'local\' -->\r\n                    <li role="separator" class="divider"></li>\r\n                    <li class="dropdown-header">Local Storage</li>\r\n                    <li><a href="#" data-bind="click: TestClearLocalStorage"><span class="glyphicon glyphicon-trash"></span> Clear data for this CBT</a></li>\r\n                    <li><a href="#" data-bind="click: TestClearAllLocalStorage"><span class="glyphicon glyphicon-trash"></span> Clear all data</a></li>\r\n                    <!-- /ko -->\r\n                    <li role="separator" class="divider"></li>\r\n                    <li><a href="#" data-bind="click: player.ShowDeveloperHelp"><span class="glyphicon glyphicon-question-sign"></span> Help</a></li>\r\n                </ul>\r\n            </div>\r\n            <!--<span>idle: <span data-bind="text: player.currentIdleSeconds"></span></span>-->\r\n        </div>\r\n    </div>\r\n</div></div>');ko.applyBindings(b,b.$devToolbar.get(0));$("#devToolbar").append(b.$devToolbar)}else{if(b.$devToolbar){ko.cleanNode(b.$devToolbar.get(0));b.$devToolbar.remove()}}});this.canPlay=ko.pureComputed(function(){return true});this.Play=ds.utils.ExtendMethod(this.Play,function(){b.PostMessage(b.framewindow,"canvasPlay")});this.canPause=ko.pureComputed(function(){return true});this.Pause=ds.utils.ExtendMethod(this.Pause,function(){this.PostMessage(this.framewindow,"canvasStop")});this.InitPageControllerAPI();this.InitTimeouts()}CBTPlayer.RegisterPageController("sco2004",SCO2004PageController);function LMSAPIBase(a){var c=this;var b={_className:"LMSAPIBase",player:null,type:PlayerConstants.LMSAPITypes.LOCAL,cbt:new CBTStructureModel(),org:null};$.extend(true,b,a);if(!b.player){throw new Error("Player instance is missing.")}this.player=b.player;this._className=b._className;this.type=b.type;this.suspendData=null;this.configData=null;this.cbt=b.cbt;if(!b.org){throw new Error("org is missing.")}this.org=b.org;this.GetValue=function(d){};this.SetValue=function(e,d){};this.Commit=function(){};this.SendComments=function(d){};this.GetConfigSettings=function(f){if(f){this.player.coreVendorText(f);try{var g,d;f.replace("corevendor:","");var k="\n";if(f.indexOf("\r\n")!==-1){k="\r\n"}if(f.indexOf(k)>=0){g=f.split(k)}else{g=f.split(",")}var l={};$.each(g,function(n,o){var e=o.split("=");l[e[0].trim()]=e[1]&&e[1].trim()});var j={};if(ds.utils.ParseBoolean(l.developerMode)!==null){j.developerMode=ds.utils.ParseBoolean(l.developerMode)}if(ds.utils.ParseBoolean(l.launchOptionsMode)!==null){j.launchOptionsMode=ds.utils.ParseBoolean(l.launchOptionsMode)}if(l.cbtStructureXMLPath){j.dataSourcePath=l.cbtStructureXMLPath}if(l.dataSourcePath){j.dataSourcePath=l.dataSourcePath}if(l.dataSourceType){j.dataSourceType=l.dataSourceType}if(l.startPageId){j.startPageId=l.startPageId}try{if(l.idleTimeOutMinutes){j.idleTimeOutMinutes=parseInt(l.idleTimeOutMinutes)}}catch(h){}j.buttons={};if(ds.utils.ParseBoolean(l.button_comments)!==null){j.buttons.comments=ds.utils.ParseBoolean(l.button_comments)}if(ds.utils.ParseBoolean(l.button_glossary)!==null){j.buttons.glossary=ds.utils.ParseBoolean(l.button_glossary)}if(ds.utils.ParseBoolean(l.button_reference)!==null){j.buttons.reference=ds.utils.ParseBoolean(l.button_reference)}if(ds.utils.ParseBoolean(l.button_audio)!==null){j.buttons.audio=ds.utils.ParseBoolean(l.button_audio)}if(ds.utils.ParseBoolean(l.button_audioText)!==null){j.buttons.audioText=ds.utils.ParseBoolean(l.button_audioText)}if(ds.utils.ParseBoolean(l.button_language)!==null){j.buttons.language=ds.utils.ParseBoolean(l.button_language)}if(ds.utils.ParseBoolean(l.button_sections)!==null){j.buttons.sections=ds.utils.ParseBoolean(l.button_sections)}if(ds.utils.ParseBoolean(l.button_progress)!==null){j.buttons.progress=ds.utils.ParseBoolean(l.button_progress)}if(ds.utils.ParseBoolean(l._singleFrame)!==null){j._singleFrame=ds.utils.ParseBoolean(l._singleFrame)}if(ds.utils.ParseBoolean(l.lmsContentProtection)!==null){j.lmsContentProtection=ds.utils.ParseBoolean(l.lmsContentProtection)}if(l.glossaryPath){j.glossaryPath=l.glossaryPath}if(l.referencesPath){j.referencesPath=l.referencesPath}if(ds.utils.ParseBoolean(l.fastAdvance)!==null){j.fastAdvance=ds.utils.ParseBoolean(l.fastAdvance)}if(l.logoPath){j.logoPath=l.logoPath}if(l.defaultOrganizationId){j.defaultOrganizationId=l.defaultOrganizationId}if(l.completionType){j.completionType=l.completionType}if(l.controlBarTopColor){j.controlBarTopColor=l.controlBarTopColor}if(l.controlBarBottomColor){j.controlBarBottomColor=l.controlBarBottomColor}if(l.controlBarBottomIconColor){j.controlBarBottomIconColor=l.controlBarBottomIconColor}if(l.controlBarBottomActiveIconColor){j.controlBarBottomActiveIconColor=l.controlBarBottomActiveIconColor}if(l.titleBarColor){j.titleBarColor=l.titleBarColor}if(l.contentContainerBackgroundColor){j.contentContainerBackgroundColor=l.contentContainerBackgroundColor}if(l.topicColor){j.topicColor=l.topicColor}if(l.ui){j.ui=l.ui}if(l.organizations){var m=l.organizations.split("|");$.each(m,function(e,n){m[e]=n.trim()});j.organizations=m}if(l.uiLangCodes){d=l.uiLangCodes.split("|");$.each(d,function(e,n){d[e]=n.trim()});j.uiLangCodes=d}if(l.hiddenItems){d=l.hiddenItems.split("|");$.each(d,function(e,n){d[e]=n.trim()});j.hiddenItems=d}try{if(l.pageLoadingTimeoutDuration){j.pageLoadingTimeoutDuration=parseInt(l.pageLoadingTimeoutDuration)}}catch(h){}if(ds.utils.ParseBoolean(l.topicCompletionMessages)!==null){j.topicCompletionMessages=ds.utils.ParseBoolean(l.topicCompletionMessages)}c.configData=j}catch(h){var i="Invalid launch options.";throw new Error(i)}}};this.GetSCORMAdapterOptions=function(d){var e={src:"../"+d,crewpad:null,learningSessionData:{learningSessionId:"1",AICC_SID:"AU1",lessonType:"Lesson",courseType:"enrolled",standard:"SCORM2004",lessonId:"",packageId:"",learnerId:this.cbt.studentId(),learnerName:"",lessonLocation:"",lessonStatus:"Not Attempted",rawScore:"0",totalTime:"00:00:00",credit:"credit",lessonMode:"normal",launchData:"cpd_debug=false",suspendData:"",masteryScore:"",maxTimeAllowed:"",timeLimitAction:""}};return e};this.GetCBTData=function(){};this.SaveCBTData=function(){};this.ApplySuspendData=function(){this.suspendData=ds.utils.RemoveCarriageReturn(this.suspendData);if(!this.suspendData){return}var e={};var d=this.suspendData.split("|");$.each(d,function(g,h){var f=h.split("=");e[f[0]]=f[1]});if(e.items){e.items=e.items.split(",");$.each(e.items,function(f,g){var k=g.search(/[a-zA-Z]/);var i;var j;var h;if(k===-1){i=parseInt(g);h=c.org().itemsList()[i];if(h){h.visited(true)}}else{i=parseInt(g.slice(0,k));j=g.slice(k,g.length);if(i>=0){h=c.org().itemsList()[i];if(h){h.visited(true);if(j==="C"){h.completed(true)}}}}})}};this._CreateSuspendData=function(){var e=this.org().itemsList();var d=[];var f="";$.map(e,function(h,g){if(h.visited()){var i=g;if(h.completed()){i+="C"}d.push(i)}});if(d.length){f="items="+d.join(",")}return f};this.Init=function(){};this.CheckLMS=function(){return false};this.Exit=function(){}};function Local(a){var c=this;var b={_className:"Local",type:PlayerConstants.LMSAPITypes.LOCAL};$.extend(true,b,a);LMSAPIBase.call(this,b);this.GetCBTData=function(){if(this.player.config._enableLocalStorage()){var d=localStorage.getItem(this._GetStorageKey());if(d){var e=JSON.parse(d);c.org().MergeModel(e.org);c.cbt.currentPageId(e.cbt.currentPageId)}}};this.SaveCBTData=function(){if(this.player.config._enableLocalStorage()){var e={org:this.org(),cbt:this.cbt,config:this.player.config};var d=ko.toJSON(e);localStorage.setItem(this._GetStorageKey(),d)}};this.ClearAllLocalStorage=function(){localStorage.clear();c.player.isClosed(true);location.reload(true)};this.ClearLocalStorage=function(){ko.utils.arrayForEach(this.cbt.organizations(),function(d){localStorage.removeItem(c._GetStorageKey(null,d.id))});c.player.isClosed(true);location.reload(true)};this._GetStorageKey=function(d,e){d=d||this.cbt.id();e=e||this.org().id;return d+"_"+e};this.Exit=function(){this.SaveCBTData()}}CBTPlayer.RegisterLMSAPIController("local",Local);function AICCAPI(a){var c=this;var b={_className:"AICCAPI",type:PlayerConstants.LMSAPITypes.AICC};$.extend(true,b,a);LMSAPIBase.call(this,b);this.VERSION="3.0";this.url="";this.aiccObj;this.GetValue=function(d){var e=new $.Deferred();if(!this.url){e.reject()}else{$.ajax({url:this.url,type:"POST",data:{command:"getParam",version:this.VERSION,session_id:this.sid,AICC_DATA:""},success:function(f,j,g){if(f.indexOf("error=1")>=0){e.reject()}else{var i=f.split("aicc_data=").pop();var h=c.ParseAICCData(i);e.resolve(h)}},error:function(g,h,f){e.reject()}})}return e.promise()};this.ParseAICCData=function(d){if(d){var e=d.split(ds.utils.stringHelper.NEWLINE);var l,m,n;var f;var k={};var h;var g={};for(var j=0;j<e.length;j++){l=e[j].trim();if(/^\[.*\]$/.test(l)){l=l.toLowerCase().trim().replace("[","").replace("]","");h=l;switch(h){case"core_vendor":case"core_lesson":k[l]="";break;default:g=k[l]={}}}else{switch(h){case"core_vendor":case"core_lesson":k[h]+=l+ds.utils.stringHelper.NEWLINE;break;default:f=l.split("=");if(f[0]){m=f[0].toLowerCase().trim();n=(f[1]||"").trim();g[m]=n}}}}return k}return null};this.StringifyAICCData=function(h){var d="";var g=ds.utils.stringHelper.NEWLINE;var e,f;for(e in h){if(h.hasOwnProperty(e)){switch(e){case"student_data":case"core_vendor":break;case"core_lesson":d+="["+e+"]"+g;d+=h[e]+g;break;default:d+="["+e+"]"+g;for(f in h[e]){var i=h[e];if(i.hasOwnProperty(f)){d+=f+"="+i[f]+g}}}}}return d};this.SetValue=function(e){var d={command:"putParam",version:c.VERSION,session_id:c.sid,AICC_DATA:e};var f=function(){c.player.ShowErrorMessage({code:PlayerConstants.ErrorCodes.PUT_PARAM_AICC})};c.PostData(d,f)};this.Commit=function(){var d=this.StringifyAICCData(c.aiccObj);this.SetValue(d)};this.SendComments=function(d){this.SetComments(d)};this.SetComments=function(e){function l(o){var n=String.fromCharCode(13)+String.fromCharCode(10);o=m(o,n," ");o=m(o,String.fromCharCode(13)," ");o=m(o,String.fromCharCode(10)," ");o=m(o,String.fromCharCode(34),String.fromCharCode(39));return o}function m(p,o,n){return p.split(o).join(n)}function h(){var n=new Date();var o=n.getFullYear().toString()+"/";o=o+g(n.getMonth()+1)+"/";o=o+g(n.getDate());return o}function i(){var n=new Date();var o=n.getHours().toString()+":";o=o+g(n.getMinutes())+":";o=o+g(n.getSeconds());return o}function g(o){var p;var n=o>=1&&o<=9;p=n?"0"+String(Math.floor(o)):String(Math.floor(o));return p}var k=new $.Deferred();var f={};f.course_id="";f.student_id=c.cbt.studentId();f.lesson_id="";f.date=h();f.time=i();f.location=c.cbt.currentPageId();f.comment=l(e);var j='"course_id","student_id","lesson_id","date","time","location","comment"';var d=j+"\r\n";d+='"'+f.course_id+'",';d+='"'+f.student_id+'",';d+='"'+f.lesson_id+'",';d+='"'+f.date+'",';d+='"'+f.time+'",';d+='"'+f.location+'",';d+='"'+f.comment+'"';$.ajax({url:this.url,type:"POST",data:{command:"putComments",version:this.VERSION,session_id:this.sid,AICC_DATA:d},success:function(n,p,o){k.resolve()},error:function(o,p,n){k.reject();c.player.ShowErrorMessage({code:PlayerConstants.ErrorCodes.PUT_COMMENT_AICC})}});return k.promise()};this.GetComments=function(){};this.GetCBTData=function(){var e=new $.Deferred();function d(f){c.aiccObj=f;var g=f.core.lesson_location;if(g){c.cbt.currentPageId(g)}var i=f.core.student_id;c.cbt.studentId(i);var h=f.core.lesson_status;switch(h){case"passed":h=PlayerConstants.LessonStatusTypes.PASSED;break;case"completed":h=PlayerConstants.LessonStatusTypes.COMPLETED;break;case"failed":h=PlayerConstants.LessonStatusTypes.FAILED;break;default:h=PlayerConstants.LessonStatusTypes.INCOMPLETE}c.cbt.lessonStatus(h);c.cbt.rawScore(f.core.score);c.GetConfigSettings(c.aiccObj.core_vendor);c.suspendData=f.core_lesson;c.GetComments();e.resolve()}$.when(this.GetValue()).done(function(f){d(f)}).fail(function(){e.reject();c.player.ShowErrorMessage({code:PlayerConstants.ErrorCodes.GET_PARAM_AICC})});return e.promise()};this.SaveCBTData=function(){this.aiccObj.core.lesson_location=this.cbt.currentPageId();this.aiccObj.core.score=this.cbt._completion.CalcRawScore()+","+this.cbt._completion.CalcMaxScore()+","+this.cbt._completion.CalcMinScore();var f=this.cbt._completion.CalcCompletion();switch(f){case PlayerConstants.LessonStatusTypes.PASSED:this.aiccObj.core.lesson_status="passed";break;case PlayerConstants.LessonStatusTypes.FAILED:this.aiccObj.core.lesson_status="failed";break;case PlayerConstants.LessonStatusTypes.COMPLETED:this.aiccObj.core.lesson_status="completed";break;case PlayerConstants.LessonStatusTypes.INCOMPLETE:this.aiccObj.core.lesson_status="incomplete";break}this.aiccObj.core_lesson=this._CreateSuspendData();var e=new Date()-c.cbt.sessionStartTime();var d=ds.utils.GetTimeInterval(e);this.aiccObj.core.time=d;this.Commit()};this.Init=function(){var d=new $.Deferred();var f=window.location.href;var e=ds.utils.GetQueryParams(f);if(e){this.sid=e.aicc_sid||null;this.url=decodeURIComponent(e.aicc_url)||null;if(this.CheckLMS()){$.when(c.GetCBTData()).done(function(){d.resolve()})}else{d.reject()}}else{d.reject()}return d.promise()};this.CheckLMS=function(){if(this.sid&&this.url){return true}return false};this.Exit=function(){c.SaveCBTData();var d={command:"exitAU",version:c.VERSION,session_id:c.sid,AICC_DATA:""};c.PostData(d,null)};this.PostData=function(d,f){if(navigator.sendBeacon){var e=new FormData();for(key in d){e.append(key,d[key])}if(!navigator.sendBeacon(c.url,e)){if(f){f()}}}else{$.ajax({url:c.url,type:"POST",data:d,async:false,error:function(h,i,g){if(f){f()}}})}}}CBTPlayer.RegisterLMSAPIController("aicc",AICCAPI);function SCORM12API(a){var c=this;var b={_className:"SCORM12API",type:PlayerConstants.LMSAPITypes.SCORM_12};$.extend(true,b,a);LMSAPIBase.call(this,b);this.GetValue=function(d){var e=doLMSGetValue(d);return e};this.SetValue=function(e,d){var f;switch(typeof d){case"object":f=ko.toJSON(d);break;case"number":f=d;break;case"undefined":f="";break;default:f=d.toString();break}return doLMSSetValue(e,f)};this.Commit=function(){doLMSCommit()};this.SetComments=function(){var d=this.GetValue("cmi.comments");var f=this.cbt.comments();return;var e=new CommentModel({studentId:3,comment:"yello",locationId:"menu",timestamp:Date.now()});var g=0;this.SetValue(SCORM2004Model.CMI.COMMENTS_FROM_LEARNER.COMMENT(g),e.comment());this.SetValue(SCORM2004Model.CMI.COMMENTS_FROM_LEARNER.LOCATION(g),e.locationId());this.SetValue(SCORM2004Model.CMI.COMMENTS_FROM_LEARNER.TIMESTAMP(g),e.timestamp())};this.GetComments=function(){};this.GetCBTData=function(){var d=this.GetValue("cmi.core.lesson_location");if(d){this.cbt.currentPageId(d)}var f=this.GetValue("cmi.core.student_id");this.cbt.studentId(f);var e=this.GetValue("cmi.core.lesson_status");switch(e){case"passed":e=PlayerConstants.LessonStatusTypes.PASSED;break;case"completed":e=PlayerConstants.LessonStatusTypes.COMPLETED;break;case"failed":e=PlayerConstants.LessonStatusTypes.FAILED;break;default:e=PlayerConstants.LessonStatusTypes.INCOMPLETE}this.cbt.lessonStatus(e);this.cbt.rawScore(this.GetValue("cmi.core.score.raw"));this.GetConfigSettings(this.GetValue("cmi.launch_data"));this.suspendData=this.GetValue("cmi.suspend_data");this.GetComments()};this.SaveCBTData=function(){this.SetValue("cmi.core.lesson_location",this.cbt.currentPageId());if(this.cbt._completion.CalcMinScore()!==null){this.SetValue("cmi.core.score.min",this.cbt._completion.CalcMinScore())}if(this.cbt._completion.CalcMaxScore()!==null){this.SetValue("cmi.core.score.max",this.cbt._completion.CalcMaxScore())}if(this.cbt._completion.CalcRawScore()!==null){this.SetValue("cmi.core.score.raw",this.cbt._completion.CalcRawScore())}if(this.cbt._completion.CalcScore()!==null){this.SetValue("cmi.core.score.scaled",this.cbt._completion.CalcScore())}var f=this.cbt._completion.CalcCompletion();switch(f){case PlayerConstants.LessonStatusTypes.PASSED:this.SetValue("cmi.core.lesson_status","passed");break;case PlayerConstants.LessonStatusTypes.FAILED:this.SetValue("cmi.core.lesson_status","failed");break;case PlayerConstants.LessonStatusTypes.COMPLETED:this.SetValue("cmi.core.lesson_status","completed");break;case PlayerConstants.LessonStatusTypes.INCOMPLETE:this.SetValue("cmi.core.lesson_status","incomplete");break}this.SetValue("cmi.suspend_data",this._CreateSuspendData());this.SetComments();var e=new Date()-c.cbt.sessionStartTime();var d=ds.utils.GetTimeInterval(e);this.SetValue("cmi.core.session_time",d);this.Commit()};this.Init=function(){var d=new $.Deferred();$.when(ds.utils.LoadObjectFromScriptFile("lib/scorm/SCORM_12_APIWrapper.min.js","doLMSInitialize")).done(function(){var e=doLMSInitialize();if(c.CheckLMS(e)){c.GetCBTData();d.resolve()}else{d.reject()}});return d.promise()};this.CheckLMS=function(d){if(d==="true"){return true}return false};this.Exit=function(){this.SaveCBTData();var e=this.cbt._completion.CalcCompletion();if(e===PlayerConstants.LessonStatusTypes.COMPLETED||e===PlayerConstants.LessonStatusTypes.PASSED){this.SetValue("cmi.core.exit","logout")}else{this.SetValue("cmi.core.exit","suspend")}var d=doLMSFinish()}}CBTPlayer.RegisterLMSAPIController("scorm12",SCORM12API);function SCORM2004API(a){var d=this;var b={_className:"SCORM2004API",type:PlayerConstants.LMSAPITypes.SCORM_2004};$.extend(true,b,a);LMSAPIBase.call(this,b);this.GetValue=function(e){var f=doGetValue(e);return f};this.SetValue=function(f,e){var g;switch(typeof e){case"object":g=ko.toJSON(e);break;case"number":g=e;break;case"undefined":g="";break;default:g=e.toString();break}return doSetValue(f,g)};this.Commit=function(){doCommit()};this.SetComments=function(){var e=this.GetValue("cmi.comments_from_learner._count");var g=this.cbt.comments();return;var f=new CommentModel({studentId:3,comment:"yello",locationId:"menu",timestamp:Date.now()});var h=0;this.SetValue(c.CMI.COMMENTS_FROM_LEARNER.COMMENT(h),f.comment());this.SetValue(c.CMI.COMMENTS_FROM_LEARNER.LOCATION(h),f.locationId());this.SetValue(c.CMI.COMMENTS_FROM_LEARNER.TIMESTAMP(h),f.timestamp())};this.GetComments=function(){var f=this.GetValue("cmi.comments_from_learner._count");var k=this.cbt.studentId();if(parseInt(f)){var e,h,l,j;for(var g=0;g<f;g++){e=this.GetValue(c.CMI.COMMENTS_FROM_LEARNER.COMMENT(g));h=this.GetValue(c.CMI.COMMENTS_FROM_LEARNER.LOCATION(g));l=this.GetValue(c.CMI.COMMENTS_FROM_LEARNER.TIMESTAMP(g));j=new CommentModel({studentId:k,comment:e,locationId:h,timestamp:l});this.cbt.comments.push(j)}}};this.GetCBTData=function(){var f=this.GetValue("cmi.location");if(f){this.cbt.currentPageId(f)}var h=this.GetValue(c.CMI.LEARNER_ID);this.cbt.studentId(h);var g;var e=this.GetValue("cmi.completion_status");var i=this.GetValue("cmi.success_status");if(e==="not attempted"||e==="incomplete"||e==="unknown"){g=PlayerConstants.LessonStatusTypes.INCOMPLETE}else{g=PlayerConstants.LessonStatusTypes.COMPLETED}if(i==="passed"){g=PlayerConstants.LessonStatusTypes.PASSED}if(i==="failed"){g=PlayerConstants.LessonStatusTypes.FAILED}this.cbt.lessonStatus(g);this.cbt.rawScore(this.GetValue("cmi.score.raw"));this.GetConfigSettings(this.GetValue("cmi.launch_data"));this.suspendData=this.GetValue("cmi.suspend_data");this.GetComments()};this.SaveCBTData=function(){this.SetValue("cmi.location",this.cbt.currentPageId());if(this.cbt._completion.CalcMinScore()!==null){this.SetValue("cmi.score.min",this.cbt._completion.CalcMinScore())}if(this.cbt._completion.CalcMaxScore()!==null){this.SetValue("cmi.score.max",this.cbt._completion.CalcMaxScore())}if(this.cbt._completion.CalcRawScore()!==null){this.SetValue("cmi.score.raw",this.cbt._completion.CalcRawScore())}if(this.cbt._completion.CalcScore()!==null){this.SetValue("cmi.score.scaled",this.cbt._completion.CalcScore())}var g=this.cbt._completion.CalcCompletion();switch(g){case PlayerConstants.LessonStatusTypes.PASSED:this.SetValue("cmi.completion_status","completed");this.SetValue("cmi.success_status","passed");break;case PlayerConstants.LessonStatusTypes.FAILED:this.SetValue("cmi.completion_status","completed");this.SetValue("cmi.success_status","failed");break;case PlayerConstants.LessonStatusTypes.COMPLETED:this.SetValue("cmi.completion_status","completed");this.SetValue("cmi.success_status","unknown");break;case PlayerConstants.LessonStatusTypes.INCOMPLETE:this.SetValue("cmi.completion_status","incomplete");this.SetValue("cmi.success_status","unknown");break}this.SetValue("cmi.suspend_data",this._CreateSuspendData());this.SetComments();var f=new Date()-d.cbt.sessionStartTime();var e=this.GetTimeInterval(f);this.SetValue(c.CMI.SESSION_TIME,e);this.Commit()};this.GetTimeInterval=function(n){var q="",l=100,j=l*60,i=j*60,h=i*24,k=h*((365*4+1)/48),m=k*12,g,s,p,e,f,o,r;g=Math.floor(n/10);s=Math.floor(g/m);g-=s*m;p=Math.floor(g/k);g-=p*k;e=Math.floor(g/h);g-=e*h;f=Math.floor(g/i);g-=f*i;o=Math.floor(g/j);g-=o*j;r=Math.floor(g/l);g-=r*l;if(s>0){q+=s+"Y"}if(p>0){q+=p+"M"}if(e>0){q+=e+"D"}if(g+r+o+f>0){q+="T";if(f>0){q+=f+"H"}if(o>0){q+=o+"M"}if(g+r>0){q+=r;if(g>0){q+="."+g}q+="S"}}if(q===""){q="0S"}q="P"+q;return q};this.Init=function(){var e=new $.Deferred();$.when(ds.utils.LoadObjectFromScriptFile("lib/scorm/SCORM_2004_APIWrapper.min.js","doInitialize")).done(function(){var f=doInitialize();if(d.CheckLMS(f)){d.GetCBTData();e.resolve()}else{e.reject()}});return e.promise()};this.CheckLMS=function(e){if(e==="true"){return true}return false};this.Exit=function(){this.SaveCBTData();var f=this.cbt._completion.CalcCompletion();if(f===PlayerConstants.LessonStatusTypes.COMPLETED||f===PlayerConstants.LessonStatusTypes.PASSED){this.SetValue(c.CMI.EXIT,"normal")}else{this.SetValue(c.CMI.EXIT,"suspend")}var e=doTerminate()};var c={CMI:{EXIT:"cmi.exit",SCORE:{MIN:"cmi.score.min",MAX:"cmi.score.max",RAW:"cmi.score.raw",SCALED:"cmi.score.scaled"},LEARNER_ID:"cmi.learner_id",LEARNER_NAME:"cmi.learner_name",COMMENTS_FROM_LEARNER:{COUNT:"cmi.comments_from_learner._count",COMMENT:function(e){return"cmi.comments_from_learner."+e+".comment"},LOCATION:function(e){return"cmi.comments_from_learner."+e+".location"},TIMESTAMP:function(e){return"cmi.comments_from_learner."+e+".timestamp"}},COMPLETION_STATUS:"cmi.completion_status",SESSION_TIME:"cmi.session_time",LOCATION:"cmi.location",SUCCESS_STATUS:"cmi.success_status",PROGRESS_MEASURE:"cmi.progress_measure",OBJECTIVES:{COUNT:"cmi.objectives._count",ID:function(e){return"cmi.objectives."+e+".id"},SUCCESS_STATUS:function(e){return"cmi.objectives."+e+".success_status"},COMPLETION_STATUS:function(e){return"cmi.objectives."+e+".completion_status"},PROGRESS_MEASURE:function(e){return"cmi.objectives."+e+".progress_measure"},DESCRIPTION:function(e){return"cmi.objectives."+e+".description"},SCORE:{MIN:function(e){return"cmi.objectives."+e+".score.min"},MAX:function(e){return"cmi.objectives."+e+".score.max"},RAW:function(e){return"cmi.objectives."+e+".score.raw"},SCALED:function(e){return"cmi.objectives."+e+".score.scaled"}}},INTERACTIONS:{COUNT:"cmi.interactions._count",ID:function(e){return"cmi.interactions."+e+".id"},DESCRIPTION:function(e){return"cmi.interactions."+e+".description"},RESULT:function(e){return"cmi.interactions."+e+".result"},TYPE:function(e){return"cmi.interactions."+e+".type"},LEARNER_RESPONSE:function(e){return"cmi.interactions."+e+".learner_response"},TIMESTAMP:function(e){return"cmi.interactions."+e+".timestamp"},LATENCY:function(e){return"cmi.interactions."+e+".latency"}}}}}CBTPlayer.RegisterLMSAPIController("scorm2004",SCORM2004API);function CompletionBase(a){var c=this;var b={_className:"CompletionBase",org:null};$.extend(true,b,a);this._className=b._className;if(!b.org){throw new Error("org is missing.")}this.org=b.org;this.CalcScore=function(){return null};this.CalcRawScore=function(){return null};this.CalcCompletion=function(){return null};this.IsCompleted=function(){return null};this.Init=function(){}};function PagesCompleteNoScore(a){var c=this;var b={_className:"PagesCompleteNoScore"};$.extend(true,b,a);CompletionBase.call(this,b);this.CalcScore=function(){return null};this.CalcRawScore=function(){return null};this.CalcMinScore=function(){return null};this.CalcMaxScore=function(){return null};this.CalcCompletion=function(){var d=this.org().items();var e=ko.utils.arrayFirst(d,function(f){return !f.completed()});if(e){return"incomplete"}else{return"completed"}};this.IsCompleted=function(){var d=this.CalcCompletion();if(d==="completed"){return true}else{return false}}}CBTPlayer.RegisterCompletionController("pagescomplete-noscore",PagesCompleteNoScore);function PagesCompleteProgress(a){var c=this;var b={_className:"PagesCompleteProgress"};$.extend(true,b,a);CompletionBase.call(this,b);this.CalcScore=function(){return c.CalcRawScore()};this.CalcRawScore=function(){var f=this.org().itemsList().filter(function(g){return g.type!=="topic"});var e=f.length;var d=this.org().itemsList().filter(function(g){return g.type!=="topic"&&g.completed()});if(f.length===0){return 100}else{return Math.floor(d.length/e*100)}};this.CalcMinScore=function(){return 0};this.CalcMaxScore=function(){return 100};this.CalcCompletion=function(){var d=this.org().items();var e=ko.utils.arrayFirst(d,function(f){return !f.completed()});if(e){return"incomplete"}else{return"completed"}};this.IsCompleted=function(){var d=this.CalcCompletion();if(d==="completed"){return true}else{return false}}}CBTPlayer.RegisterCompletionController("pagescomplete-progress",PagesCompleteProgress);function PagesVisitNoScore(a){var c=this;var b={_className:"PagesVisitNoScore"};$.extend(true,b,a);CompletionBase.call(this,b);this.CalcScore=function(){return null};this.CalcRawScore=function(){return null};this.CalcMinScore=function(){return null};this.CalcMaxScore=function(){return null};this.CalcCompletion=function(){var d=this.org().items();var e=ko.utils.arrayFirst(d,function(f){return !f.completed()});if(e){return"incomplete"}else{return"completed"}};this.IsCompleted=function(){var d=this.CalcCompletion();if(d==="completed"){return true}else{return false}};this.Init=function(d){if(d){d.on(d._events.pageLoaded,function(g,f){if(f.item){f.item.completed(true)}})}}}CBTPlayer.RegisterCompletionController("pagesvisit-noscore",PagesVisitNoScore);